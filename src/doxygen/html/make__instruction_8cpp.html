<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>PhArS: /home/milad/esc_project/svn/PARS/src/binaryTranslator/make_instruction.cpp File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.4 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">PhArS&#160;<span id="projectnumber">1</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">/home/milad/esc_project/svn/PARS/src/binaryTranslator/make_instruction.cpp File Reference</div>  </div>
</div>
<div class="contents">
<div class="textblock"><code>#include &quot;make_instruction.h&quot;</code><br/>
<code>#include &quot;regFile.h&quot;</code><br/>
<code>#include &quot;dependencyTable.h&quot;</code><br/>
<code>#include &quot;config.h&quot;</code><br/>
</div><table class="memberdecls">
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="make__instruction_8cpp.html#a1985023947a640496fdfa3654d726c9a">parseRegisters</a> (<a class="el" href="classinstruction.html">instruction</a> *newIns, FILE *input_assembly)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="make__instruction_8cpp.html#a2673a7cce171b34555a3a4249a0d61c8">parse_instruction</a> (<a class="el" href="classList.html">List</a>&lt; <a class="el" href="classinstruction.html">instruction</a> * &gt; *insList, map&lt; <a class="el" href="binaryTranslator_2global_8h.html#aa4557b0650cb21e57e3e4623410832c6">ADDR</a>, <a class="el" href="classinstruction.html">instruction</a> * &gt; *insAddrMap, set&lt; <a class="el" href="binaryTranslator_2global_8h.html#aa4557b0650cb21e57e3e4623410832c6">ADDR</a> &gt; *brDstSet, map&lt; <a class="el" href="binaryTranslator_2global_8h.html#aa4557b0650cb21e57e3e4623410832c6">ADDR</a>, double &gt; *brBiasMap, map&lt; <a class="el" href="binaryTranslator_2global_8h.html#aa4557b0650cb21e57e3e4623410832c6">ADDR</a>, double &gt; *bpAccuracyMap, map&lt; <a class="el" href="binaryTranslator_2global_8h.html#aa4557b0650cb21e57e3e4623410832c6">ADDR</a>, double &gt; *upldMap, map&lt; <a class="el" href="binaryTranslator_2global_8h.html#aa4557b0650cb21e57e3e4623410832c6">ADDR</a>, set&lt; <a class="el" href="binaryTranslator_2global_8h.html#aa4557b0650cb21e57e3e4623410832c6">ADDR</a> &gt; &gt; &amp;memRdAddrMap, map&lt; <a class="el" href="binaryTranslator_2global_8h.html#aa4557b0650cb21e57e3e4623410832c6">ADDR</a>, set&lt; <a class="el" href="binaryTranslator_2global_8h.html#aa4557b0650cb21e57e3e4623410832c6">ADDR</a> &gt; &gt; &amp;memWrAddrMap, std::string *program_name)</td></tr>
</table>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a2673a7cce171b34555a3a4249a0d61c8"></a><!-- doxytag: member="make_instruction.cpp::parse_instruction" ref="a2673a7cce171b34555a3a4249a0d61c8" args="(List&lt; instruction * &gt; *insList, map&lt; ADDR, instruction * &gt; *insAddrMap, set&lt; ADDR &gt; *brDstSet, map&lt; ADDR, double &gt; *brBiasMap, map&lt; ADDR, double &gt; *bpAccuracyMap, map&lt; ADDR, double &gt; *upldMap, map&lt; ADDR, set&lt; ADDR &gt; &gt; &amp;memRdAddrMap, map&lt; ADDR, set&lt; ADDR &gt; &gt; &amp;memWrAddrMap, std::string *program_name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void parse_instruction </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classList.html">List</a>&lt; <a class="el" href="classinstruction.html">instruction</a> * &gt; *&#160;</td>
          <td class="paramname"><em>insList</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">map&lt; <a class="el" href="binaryTranslator_2global_8h.html#aa4557b0650cb21e57e3e4623410832c6">ADDR</a>, <a class="el" href="classinstruction.html">instruction</a> * &gt; *&#160;</td>
          <td class="paramname"><em>insAddrMap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">set&lt; <a class="el" href="binaryTranslator_2global_8h.html#aa4557b0650cb21e57e3e4623410832c6">ADDR</a> &gt; *&#160;</td>
          <td class="paramname"><em>brDstSet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">map&lt; <a class="el" href="binaryTranslator_2global_8h.html#aa4557b0650cb21e57e3e4623410832c6">ADDR</a>, double &gt; *&#160;</td>
          <td class="paramname"><em>brBiasMap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">map&lt; <a class="el" href="binaryTranslator_2global_8h.html#aa4557b0650cb21e57e3e4623410832c6">ADDR</a>, double &gt; *&#160;</td>
          <td class="paramname"><em>bpAccuracyMap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">map&lt; <a class="el" href="binaryTranslator_2global_8h.html#aa4557b0650cb21e57e3e4623410832c6">ADDR</a>, double &gt; *&#160;</td>
          <td class="paramname"><em>upldMap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">map&lt; <a class="el" href="binaryTranslator_2global_8h.html#aa4557b0650cb21e57e3e4623410832c6">ADDR</a>, set&lt; <a class="el" href="binaryTranslator_2global_8h.html#aa4557b0650cb21e57e3e4623410832c6">ADDR</a> &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>memRdAddrMap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">map&lt; <a class="el" href="binaryTranslator_2global_8h.html#aa4557b0650cb21e57e3e4623410832c6">ADDR</a>, set&lt; <a class="el" href="binaryTranslator_2global_8h.html#aa4557b0650cb21e57e3e4623410832c6">ADDR</a> &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>memWrAddrMap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::string *&#160;</td>
          <td class="paramname"><em>program_name</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<div class="fragment"><pre class="fragment">                                                                 {
        <span class="keywordtype">char</span> <a class="code" href="_8AppleDouble_2sat__counter_8cpp.html#aa41808e37ba1ecae7ee6bde4a5c62f82">c</a>[<a class="code" href="binaryTranslator_2global_8h.html#a2d7378feb9600bfab350b59ffa442991">INS_STRING_SIZE</a>], ins[<a class="code" href="binaryTranslator_2global_8h.html#a2d7378feb9600bfab350b59ffa442991">INS_STRING_SIZE</a>];
        <a class="code" href="binaryTranslator_2global_8h.html#aa4557b0650cb21e57e3e4623410832c6">ADDR</a> insAddr, brDst;
        FILE * input_assembly;
        <span class="comment">// dependencyTable* depTables = new dependencyTable; /* DISABLED */</span>
        <span class="comment">// if ((input_assembly = fopen(input_asm_file, &quot;r&quot;)) == NULL) {</span>
        <span class="keywordflow">if</span> ((input_assembly = fopen((<span class="stringliteral">&quot;/home/milad/esc_project/svn/memTraceMilad/TraceSim/phraseblock_framework/input_files/&quot;</span>+(*program_name)+<span class="stringliteral">&quot;.s&quot;</span>).c_str(), <span class="stringliteral">&quot;r&quot;</span>)) == NULL) {
                <a class="code" href="backend_2utility_8h.html#aab1e54dcc40192f9704e8b252635450f">Assert</a>(<span class="stringliteral">&quot;Cannot open assembly file.&quot;</span>);
        }
        FILE * input_brBias;
        <span class="keywordflow">if</span> ((input_brBias = fopen((<span class="stringliteral">&quot;/home/milad/esc_project/svn/memTraceMilad/TraceSim/phraseblock_framework/input_files/&quot;</span>+(*program_name)+<span class="stringliteral">&quot;_bias.csv&quot;</span>).c_str(), <span class="stringliteral">&quot;r&quot;</span>)) == NULL) {
                <a class="code" href="backend_2utility_8h.html#aab1e54dcc40192f9704e8b252635450f">Assert</a>(<span class="stringliteral">&quot;Cannot open branch bias file.&quot;</span>);
        }
        FILE * input_bpAccuracy;
        <span class="keywordflow">if</span> ((input_bpAccuracy = fopen((<span class="stringliteral">&quot;/home/milad/esc_project/svn/memTraceMilad/TraceSim/phraseblock_framework/input_files/&quot;</span>+(*program_name)+<span class="stringliteral">&quot;_bpAccuracy.csv&quot;</span>).c_str(), <span class="stringliteral">&quot;r&quot;</span>)) == NULL) {
                <a class="code" href="backend_2utility_8h.html#aab1e54dcc40192f9704e8b252635450f">Assert</a>(<span class="stringliteral">&quot;Cannot open branch prediction accuracy file.&quot;</span>);
        }
        FILE * input_upld;
        <span class="keywordflow">if</span> ((input_upld = fopen(<span class="stringliteral">&quot;input_files/input_upld.csv&quot;</span>, <span class="stringliteral">&quot;r&quot;</span>)) == NULL) {
                <a class="code" href="backend_2utility_8h.html#aab1e54dcc40192f9704e8b252635450f">Assert</a>(<span class="stringliteral">&quot;Cannot open unpred load ops file.&quot;</span>);
        }

        FILE * input_mem;
        <span class="keywordflow">if</span> ((input_mem = fopen(<span class="stringliteral">&quot;frontend/mem_trace.csv&quot;</span>, <span class="stringliteral">&quot;r&quot;</span>)) == NULL) {
                <a class="code" href="backend_2utility_8h.html#aab1e54dcc40192f9704e8b252635450f">Assert</a>(<span class="stringliteral">&quot;Cannot open mem addresses file.&quot;</span>);
        }

        <span class="comment">//Parse branch bias numbers</span>
        printf(<span class="stringliteral">&quot;\tRead branch bias profile file: %s\n&quot;</span>, (<span class="stringliteral">&quot;input_files/&quot;</span>+(*program_name)+<span class="stringliteral">&quot;_bias.csv&quot;</span>).c_str());
        <span class="keywordflow">while</span> (1) {
                <a class="code" href="binaryTranslator_2global_8h.html#aa4557b0650cb21e57e3e4623410832c6">ADDR</a> addr;
                <span class="keywordtype">double</span> bias;
                <span class="keywordflow">if</span> (fscanf(input_brBias, <span class="stringliteral">&quot;%lx, %lf\n&quot;</span>, &amp;addr, &amp;bias) == EOF) <span class="keywordflow">break</span>;
                brBiasMap-&gt;insert(pair&lt;ADDR, double&gt; (addr,bias));
        }
        <span class="comment">//Parse branch prediction numbers</span>
        printf(<span class="stringliteral">&quot;\tRead branch prediction accuracy profile file: %s\n&quot;</span>, (<span class="stringliteral">&quot;input_files/&quot;</span>+(*program_name)+<span class="stringliteral">&quot;_bpAccuracy.csv&quot;</span>).c_str());
        <span class="keywordflow">while</span> (1) {
                <a class="code" href="binaryTranslator_2global_8h.html#aa4557b0650cb21e57e3e4623410832c6">ADDR</a> addr;
                <span class="keywordtype">double</span> accuracy;
                <span class="keywordflow">if</span> (fscanf(input_bpAccuracy, <span class="stringliteral">&quot;%lx, %lf\n&quot;</span>, &amp;addr, &amp;accuracy) == EOF) <span class="keywordflow">break</span>;
                bpAccuracyMap-&gt;insert(pair&lt;ADDR, double&gt; (addr,accuracy));
        }
        <span class="comment">//Parse unpredictable load numbers</span>
        printf(<span class="stringliteral">&quot;\tRead UPLD profile file: input_files/input_upld.csv\n&quot;</span>);
        <span class="keywordflow">while</span> (1) {
                <a class="code" href="binaryTranslator_2global_8h.html#aa4557b0650cb21e57e3e4623410832c6">ADDR</a> addr;
                <span class="keywordtype">double</span> missRate;
                <span class="keywordflow">if</span> (fscanf(input_upld, <span class="stringliteral">&quot;(%ld, %lf)\n&quot;</span>, &amp;addr, &amp;missRate) == EOF) <span class="keywordflow">break</span>;
                upldMap-&gt;insert(pair&lt;ADDR, double&gt; (addr,missRate));
                
        }
        <span class="comment">//Parse memory access addresses</span>
        <span class="comment">// while (1) {</span>
        <span class="comment">//      ADDR insAddr, dataAddr;</span>
        <span class="comment">//      char type;</span>
        <span class="comment">//      if (fscanf(input_mem, &quot;%llx: %c %llx\n&quot;, &amp;insAddr, &amp;type, &amp;dataAddr) == EOF) break;</span>
        <span class="comment">//      if (type == &#39;R&#39;) {</span>
        <span class="comment">//              memRdAddrMap[insAddr].insert(dataAddr);</span>
        <span class="comment">//      } else if (type == &#39;W&#39;) {</span>
        <span class="comment">//              memWrAddrMap[insAddr].insert(dataAddr);</span>
        <span class="comment">//      } else {</span>
        <span class="comment">//              Assert(&quot;Invalid memory address access type.&quot;);</span>
        <span class="comment">//      }</span>
        <span class="comment">// }</span>
        <span class="comment">//Parse assembly instructions</span>
        <span class="keywordflow">while</span> (1) {
                <span class="comment">// printf(&quot;---\n&quot;);</span>
                <a class="code" href="classinstruction.html">instruction</a> *newIns = <span class="keyword">new</span> <a class="code" href="classinstruction.html">instruction</a>;
                <span class="keywordflow">while</span>(1) {
                        <span class="keywordflow">if</span> (fgets(c, <a class="code" href="binaryTranslator_2global_8h.html#a39e5885c044e32ec0145024bd99c1594">OPCODE_STRING_SIZE</a>, input_assembly) == NULL) <span class="keywordflow">break</span>;
                        <span class="comment">// printf(&quot;debug: insType: %s\n&quot;, c);</span>
                        <span class="keywordflow">if</span> (c[0] == <span class="charliteral">&#39;j&#39;</span>  || c[0] == <span class="charliteral">&#39;b&#39;</span>|| c[0] == <span class="charliteral">&#39;c&#39;</span> || c[0] == <span class="charliteral">&#39;r&#39;</span> || c[0] == <span class="charliteral">&#39;o&#39;</span>) {
                                <span class="comment">//Find instruction type</span>
                                newIns-&gt;<a class="code" href="classinstruction.html#ad9c7d979b5f4b00189973e47caa3411f">setType</a>(c[0]);                          
                        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c[0] == <span class="charliteral">&#39;R&#39;</span> || c[0] == <span class="charliteral">&#39;W&#39;</span>) {
                                <span class="comment">//Find if instruction is a memory op</span>
                                <span class="keywordtype">int</span> memAccessSize = -1;
                                <span class="keywordflow">if</span> (c[0] == <span class="charliteral">&#39;W&#39;</span>) newIns-&gt;<a class="code" href="classinstruction.html#a1a85e010b731e20bcd25310a26eabd98">setWrMemType</a>();
                                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c[0] == <span class="charliteral">&#39;R&#39;</span>) newIns-&gt;<a class="code" href="classinstruction.html#a0d47af8822438b6e838c08dbd31cc02c">setRdMemType</a>();
                                <span class="keywordflow">if</span> (fscanf(input_assembly, <span class="stringliteral">&quot;%d\n&quot;</span>, &amp;memAccessSize) == EOF) <span class="keywordflow">break</span>;
                                newIns-&gt;<a class="code" href="classinstruction.html#a4e1387f9782160c95597c81694ec0775">setMemAccessSize</a>(memAccessSize);
                                newIns-&gt;<a class="code" href="classinstruction.html#ad9c7d979b5f4b00189973e47caa3411f">setType</a>(<span class="charliteral">&#39;M&#39;</span>);<span class="comment">//TODO: must not set if already set</span>
                        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c[0] == <span class="charliteral">&#39;#&#39;</span>) {
                                <span class="comment">//Set the instruction opcode mnemonic</span>
                                newIns-&gt;<a class="code" href="classinstruction.html#a7a4adbec8d2e9a2cb6090168530e336c">setOpCode</a>(c);
                                <span class="keywordflow">break</span>;
                        } <span class="keywordflow">else</span> {
                                <a class="code" href="backend_2utility_8h.html#aab1e54dcc40192f9704e8b252635450f">Assert</a>(<span class="stringliteral">&quot;Instruction Type was not recognized.&quot;</span>);
                        }
                }
                <span class="comment">//Set instruction disassembled code</span>
                <span class="keywordflow">if</span> (fgets(ins, <a class="code" href="binaryTranslator_2global_8h.html#a2d7378feb9600bfab350b59ffa442991">INS_STRING_SIZE</a>, input_assembly) == NULL) <span class="keywordflow">break</span>;
                newIns-&gt;<a class="code" href="classinstruction.html#ae28df36b635c5359fa48a6476eebc425">setInsAsm</a>(ins);
                <span class="comment">// printf(&quot;debug: ASM: %s\n&quot;, ins);</span>
                <span class="comment">//Set instruction address</span>
                <span class="keywordflow">if</span> (fscanf(input_assembly, <span class="stringliteral">&quot;%llx\n&quot;</span>, &amp;insAddr) == EOF) <span class="keywordflow">break</span>;
                newIns-&gt;<a class="code" href="classinstruction.html#ac39145295a94852d0a3efe8c8247473d">setInsAddr</a>(insAddr);
                <span class="comment">// printf(&quot;debug: insAddr = %llx\n&quot;, insAddr);</span>
                <span class="comment">//Setup instruction branch destination/bias/accuracy information</span>
                <span class="keywordflow">if</span> (newIns-&gt;<a class="code" href="classinstruction.html#a47623362d505a662b974624f81288389">getType</a>() == <span class="charliteral">&#39;j&#39;</span>  || newIns-&gt;<a class="code" href="classinstruction.html#a47623362d505a662b974624f81288389">getType</a>() == <span class="charliteral">&#39;b&#39;</span>|| newIns-&gt;<a class="code" href="classinstruction.html#a47623362d505a662b974624f81288389">getType</a>() == <span class="charliteral">&#39;c&#39;</span>) {
                        <span class="keywordflow">if</span> (fscanf(input_assembly, <span class="stringliteral">&quot;%llx\n&quot;</span>, &amp;brDst) == EOF) <span class="keywordflow">break</span>;
                        newIns-&gt;<a class="code" href="classinstruction.html#aeeee9fa55e89a75f59d160c0aad34a52">setBrDst</a>(brDst);
                        brDstSet-&gt;insert(brDst);
                        <span class="comment">//Setup branch prediction accuracy information</span>
                        <span class="keywordflow">if</span> (bpAccuracyMap-&gt;find(insAddr) != bpAccuracyMap-&gt;end()) {
                                newIns-&gt;<a class="code" href="classinstruction.html#a613fd5dcaabf9a68596545679b17ffd8">setBPaccuracy</a>((*bpAccuracyMap)[insAddr]);
                        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (newIns-&gt;<a class="code" href="classinstruction.html#a47623362d505a662b974624f81288389">getType</a>() == <span class="charliteral">&#39;b&#39;</span>) {
                                ;<span class="comment">// printf(&quot;ERROR: branch instruction prediction accuracy not found! (%s, line: %d)\n&quot; , __FILE__, __LINE__);</span>
                                <span class="comment">//exit(1);</span>
                        }
                        <span class="comment">//Setup branch bias information</span>
                        <span class="keywordflow">if</span> (brBiasMap-&gt;find(insAddr) != brBiasMap-&gt;end()) {
                                newIns-&gt;<a class="code" href="classinstruction.html#aabc818127836c8403b9c691985ca6d14">setBrTakenBias</a>((*brBiasMap)[insAddr]);
                        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (newIns-&gt;<a class="code" href="classinstruction.html#a47623362d505a662b974624f81288389">getType</a>() == <span class="charliteral">&#39;b&#39;</span>) {
                                ;<span class="comment">// printf(&quot;ERROR: branch instruction bias not found! (%s, line: %d)\n&quot; , __FILE__, __LINE__);</span>
                                <span class="comment">//exit(1);</span>
                        }
                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (newIns-&gt;<a class="code" href="classinstruction.html#a47623362d505a662b974624f81288389">getType</a>() == <span class="charliteral">&#39;M&#39;</span>) {
                        <span class="keywordflow">if</span> (memRdAddrMap.find(insAddr) != memRdAddrMap.end()) {
                                newIns-&gt;<a class="code" href="classinstruction.html#a379cbb0fb6bbe15168c6eac05a37114f">setRdAddrSet</a>(memRdAddrMap[insAddr]);
                        } 
                        <span class="keywordflow">if</span> (memWrAddrMap.find(insAddr) != memWrAddrMap.end()) {
                                newIns-&gt;<a class="code" href="classinstruction.html#a8928d9fe638fd7307606fac71a31b681">setWrAddrSet</a>(memWrAddrMap[insAddr]);
                        }
                }
                <span class="comment">//Set miss-rate if instruction is a UPLD</span>
                <span class="keywordflow">if</span> (upldMap-&gt;find(insAddr) != upldMap-&gt;end() &amp;&amp; newIns-&gt;<a class="code" href="classinstruction.html#abf5f8947b16c91c4e21b82bec378008f">isRdMemType</a>() == <span class="keyword">true</span>) {
                        newIns-&gt;<a class="code" href="classinstruction.html#a5052a04bf5db0d0e1519eb54f343bdc6">setLdMissRate</a>((*upldMap)[insAddr]);
                }
                <span class="comment">//Set instruction registers (read &amp; write)</span>
                <a class="code" href="make__instruction_8cpp.html#a1985023947a640496fdfa3654d726c9a">parseRegisters</a>(newIns, input_assembly);
                <span class="comment">// newIns-&gt;setOpCode(opCode); done somewhere else</span>
                insList-&gt;<a class="code" href="classList.html#a473190098e38206d0125b0737245e613">Append</a>(newIns);
                insAddrMap-&gt;insert(pair&lt;ADDR, instruction*&gt; (newIns-&gt;<a class="code" href="classinstruction.html#ac1fabe854c85726785052c7a5ebf6d39">getInsAddr</a>(), newIns));
                <span class="comment">// newIns-&gt;dependencyTableCheck(depTables); /* DISABLED */</span>
        }

        <span class="comment">//Close files</span>
        fclose(input_assembly);
        fclose(input_brBias);
        fclose(input_bpAccuracy);
        fclose(input_upld);
        fclose(input_mem);
}</pre></div>
</div>
</div>
<a class="anchor" id="a1985023947a640496fdfa3654d726c9a"></a><!-- doxytag: member="make_instruction.cpp::parseRegisters" ref="a1985023947a640496fdfa3654d726c9a" args="(instruction *newIns, FILE *input_assembly)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void parseRegisters </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classinstruction.html">instruction</a> *&#160;</td>
          <td class="paramname"><em>newIns</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">FILE *&#160;</td>
          <td class="paramname"><em>input_assembly</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<div class="fragment"><pre class="fragment">                                                               {
        <a class="code" href="classregFile.html">regFile</a>* <a class="code" href="bkEnd_8cpp.html#a2d3dfa31b077f1d81553e749601f1c58">RF</a> = <span class="keyword">new</span> <a class="code" href="classregFile.html">regFile</a>;
        <span class="keywordtype">char</span> reg[<a class="code" href="binaryTranslator_2global_8h.html#a3088356e3c44bedd210a9cc28246cf82">REG_STRING_SIZE</a>];
        <span class="keywordtype">int</span> read_write = 0;
        <span class="keywordtype">long</span> <span class="keywordtype">int</span> regCode;
        <span class="keywordflow">while</span>(1) {
                <span class="keywordflow">if</span> (fgets(reg, <a class="code" href="binaryTranslator_2global_8h.html#a3088356e3c44bedd210a9cc28246cf82">REG_STRING_SIZE</a>, input_assembly) == NULL) <a class="code" href="backend_2utility_8h.html#aab1e54dcc40192f9704e8b252635450f">Assert</a>(<span class="stringliteral">&quot;Register name not found&quot;</span>);
                <span class="keywordflow">if</span> (reg[0] == <span class="charliteral">&#39;-&#39;</span>) <span class="keywordflow">break</span>; <span class="comment">//some ops have no reg</span>
                <span class="keywordflow">if</span> (fscanf(input_assembly, <span class="stringliteral">&quot;%d\n&quot;</span>, &amp;read_write) == EOF) <a class="code" href="backend_2utility_8h.html#aab1e54dcc40192f9704e8b252635450f">Assert</a>(<span class="stringliteral">&quot;Register type not found&quot;</span>);
                reg[strlen(reg) - 1] = 0; <span class="comment">//cut out newline</span>
                regCode = RF-&gt;<a class="code" href="classregFile.html#a8e27b1edd7cbb6d8820a73fb1d7d8c71">getRegNum</a>(reg);
                <span class="keywordflow">if</span> (regCode != <a class="code" href="binaryTranslator_2global_8h.html#ac2e4520b753f883cd8050dbf1864db08">INVALID_REG</a>) {
                        newIns-&gt;<a class="code" href="classinstruction.html#a456de8aa26ff79d2b7cd203f7c59f2cb">setRegister</a>(&amp;regCode, &amp;read_write);
                }
                <span class="comment">// printf(&quot;debug: %d, %d, %s\n&quot;, read_write, regCode, reg);</span>
        }
        <span class="keyword">delete</span> <a class="code" href="bkEnd_8cpp.html#a2d3dfa31b077f1d81553e749601f1c58">RF</a>;
}
</pre></div>
</div>
</div>
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address class="footer"><small>Generated on Fri Jul 18 2014 for PhArS by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </small></address>
</body>
</html>
