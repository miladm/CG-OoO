<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>PhArS: /home/milad/esc_project/svn/PARS/src/binaryTranslator/make_instruction.cpp File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.4 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">PhArS&#160;<span id="projectnumber">1</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">/home/milad/esc_project/svn/PARS/src/binaryTranslator/make_instruction.cpp File Reference</div>  </div>
</div>
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="make__instruction_8h_source.html">make_instruction.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="regFile_8h_source.html">regFile.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="dependencyTable_8h_source.html">dependencyTable.h</a>&quot;</code><br/>
<code>#include &quot;config.h&quot;</code><br/>
</div><div class="textblock"><div class="dynheader">
Include dependency graph for make_instruction.cpp:</div>
<div class="dyncontent">
<div class="center"><img src="make__instruction_8cpp__incl.png" border="0" usemap="#_2home_2milad_2esc__project_2svn_2PARS_2src_2binaryTranslator_2make__instruction_8cpp" alt=""/></div>
<map name="_2home_2milad_2esc__project_2svn_2PARS_2src_2binaryTranslator_2make__instruction_8cpp" id="_2home_2milad_2esc__project_2svn_2PARS_2src_2binaryTranslator_2make__instruction_8cpp">
</map>
</div>
</div><table class="memberdecls">
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="make__instruction_8cpp.html#a1985023947a640496fdfa3654d726c9a">parseRegisters</a> (<a class="el" href="classinstruction.html">instruction</a> *newIns, FILE *input_assembly)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="make__instruction_8cpp.html#abe7a2d116e3e54c66d70fff6e83b0bae">parse_instruction</a> (<a class="el" href="classList.html">List</a>&lt; <a class="el" href="classinstruction.html">instruction</a> * &gt; *insList, map&lt; <a class="el" href="binaryTranslator_2global_8h.html#a8bb6b77b3aab51e3a8d1866dd5861225">ADDR</a>, <a class="el" href="classinstruction.html">instruction</a> * &gt; *insAddrMap, set&lt; <a class="el" href="binaryTranslator_2global_8h.html#a8bb6b77b3aab51e3a8d1866dd5861225">ADDR</a> &gt; *brDstSet, map&lt; <a class="el" href="binaryTranslator_2global_8h.html#a8bb6b77b3aab51e3a8d1866dd5861225">ADDR</a>, double &gt; *brBiasMap, map&lt; <a class="el" href="binaryTranslator_2global_8h.html#a8bb6b77b3aab51e3a8d1866dd5861225">ADDR</a>, double &gt; *bpAccuracyMap, map&lt; <a class="el" href="binaryTranslator_2global_8h.html#a8bb6b77b3aab51e3a8d1866dd5861225">ADDR</a>, double &gt; *upldMap, map&lt; <a class="el" href="binaryTranslator_2global_8h.html#a8bb6b77b3aab51e3a8d1866dd5861225">ADDR</a>, set&lt; <a class="el" href="binaryTranslator_2global_8h.html#a8bb6b77b3aab51e3a8d1866dd5861225">ADDR</a> &gt; &gt; &amp;memRdAddrMap, map&lt; <a class="el" href="binaryTranslator_2global_8h.html#a8bb6b77b3aab51e3a8d1866dd5861225">ADDR</a>, set&lt; <a class="el" href="binaryTranslator_2global_8h.html#a8bb6b77b3aab51e3a8d1866dd5861225">ADDR</a> &gt; &gt; &amp;memWrAddrMap, std::string *program_name, <a class="el" href="binaryTranslator_2global_8h.html#af9119e90106116692c2c7bc54461ed3d">CLUSTER_MODE</a> cluster_mode)</td></tr>
</table>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="abe7a2d116e3e54c66d70fff6e83b0bae"></a><!-- doxytag: member="make_instruction.cpp::parse_instruction" ref="abe7a2d116e3e54c66d70fff6e83b0bae" args="(List&lt; instruction * &gt; *insList, map&lt; ADDR, instruction * &gt; *insAddrMap, set&lt; ADDR &gt; *brDstSet, map&lt; ADDR, double &gt; *brBiasMap, map&lt; ADDR, double &gt; *bpAccuracyMap, map&lt; ADDR, double &gt; *upldMap, map&lt; ADDR, set&lt; ADDR &gt; &gt; &amp;memRdAddrMap, map&lt; ADDR, set&lt; ADDR &gt; &gt; &amp;memWrAddrMap, std::string *program_name, CLUSTER_MODE cluster_mode)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void parse_instruction </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classList.html">List</a>&lt; <a class="el" href="classinstruction.html">instruction</a> * &gt; *&#160;</td>
          <td class="paramname"><em>insList</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">map&lt; <a class="el" href="binaryTranslator_2global_8h.html#a8bb6b77b3aab51e3a8d1866dd5861225">ADDR</a>, <a class="el" href="classinstruction.html">instruction</a> * &gt; *&#160;</td>
          <td class="paramname"><em>insAddrMap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">set&lt; <a class="el" href="binaryTranslator_2global_8h.html#a8bb6b77b3aab51e3a8d1866dd5861225">ADDR</a> &gt; *&#160;</td>
          <td class="paramname"><em>brDstSet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">map&lt; <a class="el" href="binaryTranslator_2global_8h.html#a8bb6b77b3aab51e3a8d1866dd5861225">ADDR</a>, double &gt; *&#160;</td>
          <td class="paramname"><em>brBiasMap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">map&lt; <a class="el" href="binaryTranslator_2global_8h.html#a8bb6b77b3aab51e3a8d1866dd5861225">ADDR</a>, double &gt; *&#160;</td>
          <td class="paramname"><em>bpAccuracyMap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">map&lt; <a class="el" href="binaryTranslator_2global_8h.html#a8bb6b77b3aab51e3a8d1866dd5861225">ADDR</a>, double &gt; *&#160;</td>
          <td class="paramname"><em>upldMap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">map&lt; <a class="el" href="binaryTranslator_2global_8h.html#a8bb6b77b3aab51e3a8d1866dd5861225">ADDR</a>, set&lt; <a class="el" href="binaryTranslator_2global_8h.html#a8bb6b77b3aab51e3a8d1866dd5861225">ADDR</a> &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>memRdAddrMap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">map&lt; <a class="el" href="binaryTranslator_2global_8h.html#a8bb6b77b3aab51e3a8d1866dd5861225">ADDR</a>, set&lt; <a class="el" href="binaryTranslator_2global_8h.html#a8bb6b77b3aab51e3a8d1866dd5861225">ADDR</a> &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>memWrAddrMap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::string *&#160;</td>
          <td class="paramname"><em>program_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="binaryTranslator_2global_8h.html#af9119e90106116692c2c7bc54461ed3d">CLUSTER_MODE</a>&#160;</td>
          <td class="paramname"><em>cluster_mode</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<div class="fragment"><pre class="fragment">                                               {
        <span class="keywordtype">char</span> c[<a class="code" href="binaryTranslator_2global_8h.html#a2d7378feb9600bfab350b59ffa442991">INS_STRING_SIZE</a>], ins[<a class="code" href="binaryTranslator_2global_8h.html#a2d7378feb9600bfab350b59ffa442991">INS_STRING_SIZE</a>];
        <a class="code" href="binaryTranslator_2global_8h.html#a8bb6b77b3aab51e3a8d1866dd5861225">ADDR</a> insAddr, insFallThru, insDst, brDst;
        <span class="keywordtype">bool</span> hasFallThru, hasDst;
        FILE * input_assembly;
        FILE * input_brBias;
        FILE * input_bpAccuracy;
        FILE * input_upld;
        FILE * input_mem;

        <span class="comment">// if ((input_assembly = fopen (input_asm_file, &quot;r&quot;)) == NULL) {</span>

    <span class="keywordtype">string</span> input_path = <span class="stringliteral">&quot;/home/milad/esc_project/svn/PARS/src/binaryTranslator/input_files/&quot;</span>;
    <span class="keywordtype">string</span> profile_path = <span class="stringliteral">&quot;/home/milad/esc_project/svn/PARS/src/binaryTranslator/profile_files/ref/&quot;</span>;

    <span class="comment">/* ASSSEMBLY FILE FETCH */</span>
        <span class="keywordflow">if</span> ((input_assembly = fopen ((input_path + (*program_name) + <span class="stringliteral">&quot;.s&quot;</span>).c_str (), <span class="stringliteral">&quot;r&quot;</span>)) == NULL) {
                <a class="code" href="binaryTranslator_2frontend_2utility_8h.html#aab1e54dcc40192f9704e8b252635450f">Assert</a> (0 &amp;&amp; <span class="stringliteral">&quot;Cannot open assembly file.&quot;</span>);
        }

    <span class="comment">/* BRANCH BIAS FILE FETCH */</span>
    ostringstream lo_wbb, hi_wbb;
    lo_wbb &lt;&lt; <a class="code" href="binaryTranslator_2global_8h.html#ab03221b2744b3969f9076d40f6dcef32">WBB_LOWER_BOUND</a>;
    hi_wbb &lt;&lt; <a class="code" href="binaryTranslator_2global_8h.html#a5b19e872c39de2e1e86de7d8edc1097e">WBB_UPPER_BOUND</a>;
    <span class="keywordtype">string</span> file_ext = <span class="stringliteral">&quot;_wbb_&quot;</span> + lo_wbb.str () + <span class="stringliteral">&quot;_&quot;</span> + hi_wbb.str () + <span class="stringliteral">&quot;.csv&quot;</span>;
        <span class="keywordflow">if</span> ((input_brBias = fopen ((profile_path + (*program_name) + file_ext).c_str (), <span class="stringliteral">&quot;r&quot;</span>)) == NULL) {
                printf (<span class="stringliteral">&quot;\tWARNING: Cannot open branch bias file.\n&quot;</span>);
<span class="comment">//              Assert (0 &amp;&amp; &quot;Cannot open branch bias file.\n&quot;);</span>
        }

    <span class="comment">/* BRANCH ACCURACY FILE FETCH */</span>
<span class="comment">//    ostringstream upld_thr;</span>
<span class="comment">//    upld_thr &lt;&lt; UPLD_THRESHOLD;</span>
<span class="comment">//    file_ext = &quot;_upld_&quot; + upld_thr.str () + &quot;.csv&quot;;</span>
<span class="comment">//      if ((input_bpAccuracy = fopen ((input_path + (*program_name) + file_ext).c_str (), &quot;r&quot;)) == NULL) {</span>
<span class="comment">//              Assert (0 &amp;&amp; &quot;Cannot open branch prediction accuracy file.&quot;);</span>
<span class="comment">//      }</span>

    <span class="comment">/* UPLD FILE FETCH */</span>
    ostringstream upld_thr;
    upld_thr &lt;&lt; <a class="code" href="binaryTranslator_2global_8h.html#a09af7f6f05439583552ca729af9dc232">UPLD_THRESHOLD</a>;
    file_ext = <span class="stringliteral">&quot;_upld_&quot;</span> + upld_thr.str () + <span class="stringliteral">&quot;.csv&quot;</span>;
        input_upld = fopen ((profile_path + (*program_name) + file_ext).c_str (), <span class="stringliteral">&quot;r&quot;</span>);
        <span class="keywordflow">if</span> (input_upld == NULL) {
                printf (<span class="stringliteral">&quot;\tWARNING: Cannot open UPLD ops file.\n&quot;</span>);
<span class="comment">//              Assert (0 &amp;&amp; &quot;Cannot open UPLD ops file.&quot;);</span>
        }

    <span class="comment">/* MEMORY TRACE FILE FETCH */</span>
        <span class="keywordflow">if</span> ((input_mem = fopen (<span class="stringliteral">&quot;frontend/mem_trace.csv&quot;</span>, <span class="stringliteral">&quot;r&quot;</span>)) == NULL) {
                <a class="code" href="binaryTranslator_2frontend_2utility_8h.html#aab1e54dcc40192f9704e8b252635450f">Assert</a> (0 &amp;&amp; <span class="stringliteral">&quot;Cannot open mem addresses file.&quot;</span>);
        }

        <span class="comment">/* PARSE BRANCH BIAS NUMBERS */</span>
    <span class="keywordflow">if</span> (input_brBias != NULL) {
        printf (<span class="stringliteral">&quot;\tRead branch BIAS profile file\n&quot;</span>);
        <span class="keywordflow">while</span> (1) {
            <a class="code" href="binaryTranslator_2global_8h.html#a8bb6b77b3aab51e3a8d1866dd5861225">ADDR</a> addr;
            <span class="keywordtype">double</span> bias;
            <span class="keywordtype">int</span> taken, br;
            <span class="keywordflow">if</span> (fscanf (input_brBias, <span class="stringliteral">&quot;%lx,%lf,%d,%d\n&quot;</span>, &amp;addr, &amp;bias, &amp;taken, &amp;br) == EOF) <span class="keywordflow">break</span>;
            brBiasMap-&gt;insert (pair&lt;ADDR, double&gt; (addr,bias));
        }
    } <span class="keywordflow">else</span> {
        printf (<span class="stringliteral">&quot;\tWARNING: BIAS profile file NOT read.\n&quot;</span>);
    }

        <span class="comment">/* PARSE BRANCH PREDICTION NUMBERS */</span>
<span class="comment">//      printf (&quot;\tRead branch prediction accuracy profile file\n&quot;);</span>
<span class="comment">//      while (1) {</span>
<span class="comment">//              ADDR addr;</span>
<span class="comment">//              double accuracy;</span>
<span class="comment">//              if (fscanf (input_bpAccuracy, &quot;%lx, %lf\n&quot;, &amp;addr, &amp;accuracy) == EOF) break;</span>
<span class="comment">//              bpAccuracyMap-&gt;insert (pair&lt;ADDR, double&gt; (addr,accuracy));</span>
<span class="comment">//      }</span>

        <span class="comment">/* PARSE UNPREDICTABLE LOAD NUMBERS */</span>
    <span class="keywordflow">if</span> (input_upld != NULL) {
        printf (<span class="stringliteral">&quot;\tRead UPLD profile file\n&quot;</span>);
        <span class="keywordflow">while</span> (1) {
            <a class="code" href="binaryTranslator_2global_8h.html#a8bb6b77b3aab51e3a8d1866dd5861225">ADDR</a> addr;
            <span class="keywordtype">double</span> missRate;
            <span class="keywordtype">int</span> miss_ld, ld;
            <span class="keywordflow">if</span> (fscanf (input_upld, <span class="stringliteral">&quot;%lx, %lf,%d,%d\n&quot;</span>, &amp;addr, &amp;missRate, &amp;miss_ld, &amp;ld) == EOF) <span class="keywordflow">break</span>;
            upldMap-&gt;insert (pair&lt;ADDR, double&gt; (addr, missRate));
        }
    } <span class="keywordflow">else</span> {
        printf (<span class="stringliteral">&quot;\tWARNING: UPLD profile file NOT read.\n&quot;</span>);
    }

        <span class="comment">//Parse memory access addresses</span>
        <span class="comment">// while (1) {</span>
        <span class="comment">//      ADDR insAddr, dataAddr;</span>
        <span class="comment">//      char type;</span>
        <span class="comment">//      if (fscanf (input_mem, &quot;%llx: %c %llx\n&quot;, &amp;insAddr, &amp;type, &amp;dataAddr) == EOF) break;</span>
        <span class="comment">//      if (type == &#39;R&#39;) {</span>
        <span class="comment">//              memRdAddrMap[insAddr].insert (dataAddr);</span>
        <span class="comment">//      } else if (type == &#39;W&#39;) {</span>
        <span class="comment">//              memWrAddrMap[insAddr].insert (dataAddr);</span>
        <span class="comment">//      } else {</span>
        <span class="comment">//              Assert (0 &amp;&amp; &quot;Invalid memory address access type.&quot;);</span>
        <span class="comment">//      }</span>
        <span class="comment">// }</span>

        <span class="comment">/* PARSE ASSEMBLY INSTRUCTIONS */</span>
        printf (<span class="stringliteral">&quot;\tRead X86 .s file: %s\n&quot;</span>, (<span class="stringliteral">&quot;input_files/&quot;</span>+ (*program_name) + <span class="stringliteral">&quot;.s&quot;</span>).c_str ());
        <span class="keywordflow">while</span> (1) {
                <a class="code" href="classinstruction.html">instruction</a> *newIns = <span class="keyword">new</span> <a class="code" href="classinstruction.html">instruction</a>;
                <span class="keywordflow">while</span> (1) {
                        <span class="keywordflow">if</span> (fgets (c, <a class="code" href="binaryTranslator_2global_8h.html#a39e5885c044e32ec0145024bd99c1594">OPCODE_STRING_SIZE</a>, input_assembly) == NULL) <span class="keywordflow">break</span>;
                        <span class="comment">// printf (&quot;debug: insType: %s\n&quot;, c);</span>
                        <span class="keywordflow">if</span> (c[0] == <span class="charliteral">&#39;j&#39;</span>  || c[0] == <span class="charliteral">&#39;b&#39;</span>|| c[0] == <span class="charliteral">&#39;c&#39;</span> || c[0] == <span class="charliteral">&#39;r&#39;</span>  || c[0] == <span class="charliteral">&#39;o&#39;</span>|| c[0] == <span class="charliteral">&#39;n&#39;</span> || c[0] == <span class="charliteral">&#39;s&#39;</span>) {
                                <span class="comment">/* SET INSTRUCTION TYPE */</span>
                                newIns-&gt;<a class="code" href="classinstruction.html#aa6ff7d5323483cf18c10687ed8c1dc73">setType</a> (c[0]);
                        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c[0] == <span class="charliteral">&#39;R&#39;</span> || c[0] == <span class="charliteral">&#39;W&#39;</span>) {
                                <span class="comment">/* SET IF INSTRUCTION IS A MEMORY OP */</span>
                                <span class="keywordtype">int</span> memAccessSize = -1;
                                <span class="keywordflow">if</span> (c[0] == <span class="charliteral">&#39;W&#39;</span>) newIns-&gt;<a class="code" href="classinstruction.html#a1a85e010b731e20bcd25310a26eabd98">setWrMemType</a> ();
                                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c[0] == <span class="charliteral">&#39;R&#39;</span>) newIns-&gt;<a class="code" href="classinstruction.html#a0d47af8822438b6e838c08dbd31cc02c">setRdMemType</a> ();
                                <span class="keywordflow">if</span> (fscanf (input_assembly, <span class="stringliteral">&quot;%d\n&quot;</span>, &amp;memAccessSize) == EOF) <span class="keywordflow">break</span>;
                                newIns-&gt;<a class="code" href="classinstruction.html#ab36280a1a2cd3339e45c8271deaa23d0">setMemAccessSize</a> (memAccessSize);
                                newIns-&gt;<a class="code" href="classinstruction.html#aa6ff7d5323483cf18c10687ed8c1dc73">setType</a> (<span class="charliteral">&#39;M&#39;</span>);<span class="comment">//TODO: must not set if already set</span>
                        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c[0] == <span class="charliteral">&#39;#&#39;</span>) {
                                <span class="comment">/* SET THE INSTRUCTION OPCODE MNEMONIC */</span>
                                newIns-&gt;<a class="code" href="classinstruction.html#a7a4adbec8d2e9a2cb6090168530e336c">setOpCode</a> (c);
                                <span class="keywordflow">break</span>;
                        } <span class="keywordflow">else</span> {
                                <a class="code" href="binaryTranslator_2frontend_2utility_8h.html#aab1e54dcc40192f9704e8b252635450f">Assert</a> (0 &amp;&amp; <span class="stringliteral">&quot;Instruction Type was not recognized.&quot;</span>);
                        }
                }

                <span class="comment">/* SET INSTRUCTION DISASSEMBLED CODE */</span>
                <span class="keywordflow">if</span> (fgets (ins, <a class="code" href="binaryTranslator_2global_8h.html#a2d7378feb9600bfab350b59ffa442991">INS_STRING_SIZE</a>, input_assembly) == NULL) <span class="keywordflow">break</span>;
                newIns-&gt;<a class="code" href="classinstruction.html#ae28df36b635c5359fa48a6476eebc425">setInsAsm</a> (ins);
                <span class="comment">// printf (&quot;debug: ASM: %s\n&quot;, ins);</span>

                <span class="comment">/* SET INSTRUCTION ADDRESS */</span>
                <span class="keywordflow">if</span> (fscanf (input_assembly, <span class="stringliteral">&quot;%llx\n&quot;</span>, &amp;insAddr) == EOF) <span class="keywordflow">break</span>;
                newIns-&gt;<a class="code" href="classinstruction.html#affb2525016712f3bac93120d4d81961d">setInsAddr</a> (insAddr);
                <span class="comment">// printf (&quot;debug: insAddr = %llx\n&quot;, insAddr);</span>

        <span class="comment">/* SET INSTRUCTION FALL-THROUGH */</span>
        insFallThru = 0;
                <span class="keywordflow">if</span> (fscanf (input_assembly, <span class="stringliteral">&quot;%d\n&quot;</span>, &amp;hasFallThru) == EOF) <span class="keywordflow">break</span>;
                <span class="keywordflow">if</span> (hasFallThru) {<span class="keywordflow">if</span> (fscanf (input_assembly, <span class="stringliteral">&quot;%llx\n&quot;</span>, &amp;insFallThru) == EOF) <span class="keywordflow">break</span>;}
                newIns-&gt;<a class="code" href="classinstruction.html#ab0119dd691b88e7cedb51d4f48c829a9">setInsFallThruAddr</a> (insFallThru, hasFallThru);

        <span class="comment">/* SET INSTRUCTION DESTIATION */</span>
        insDst = 0;
                <span class="keywordflow">if</span> (fscanf (input_assembly, <span class="stringliteral">&quot;%d\n&quot;</span>, &amp;hasDst) == EOF) <span class="keywordflow">break</span>;
        <span class="keywordflow">if</span> (hasDst) {<span class="keywordflow">if</span> (fscanf (input_assembly, <span class="stringliteral">&quot;%llx\n&quot;</span>, &amp;insDst) == EOF) <span class="keywordflow">break</span>;}
                newIns-&gt;<a class="code" href="classinstruction.html#a3ee6f1e5c349643f6734df78619c86f9">setInsDstAddr</a> (insDst, hasDst);

                <span class="comment">/* SETUP INSTRUCTION BRANCH DESTINATION INFORMATION */</span>
                <span class="keywordflow">if</span> (newIns-&gt;<a class="code" href="classinstruction.html#a47623362d505a662b974624f81288389">getType</a> () == <span class="charliteral">&#39;j&#39;</span> || newIns-&gt;<a class="code" href="classinstruction.html#a47623362d505a662b974624f81288389">getType</a> () == <span class="charliteral">&#39;b&#39;</span> || newIns-&gt;<a class="code" href="classinstruction.html#a47623362d505a662b974624f81288389">getType</a> () == <span class="charliteral">&#39;c&#39;</span>) {
                        <span class="comment">/* SETUP BB START SET */</span>
                        <span class="keywordflow">if</span> (newIns-&gt;<a class="code" href="classinstruction.html#ac0f0a724c1207fd9c2aad8897f3c9842">hasDst</a> ()) 
                brDstSet-&gt;insert (newIns-&gt;<a class="code" href="classinstruction.html#a600fd1454a34eca9a64057e3c019a795">getInsDstAddr</a> ());
                        <span class="keywordflow">if</span> (newIns-&gt;<a class="code" href="classinstruction.html#a2d7b01a0443263782d84906eb8c35ccc">hasFallThru</a> () &amp;&amp; 
                (newIns-&gt;<a class="code" href="classinstruction.html#a47623362d505a662b974624f81288389">getType</a> () == <span class="charliteral">&#39;b&#39;</span> || newIns-&gt;<a class="code" href="classinstruction.html#a47623362d505a662b974624f81288389">getType</a> () == <span class="charliteral">&#39;c&#39;</span>)) 
                brDstSet-&gt;insert (newIns-&gt;<a class="code" href="classinstruction.html#a6b94ce0e75e6676de23c2a87a19eecd3">getInsFallThruAddr</a> ());
        }

                <span class="comment">/* SETUP INSTRUCTION BRANCH BIAS/ACCURACY INFORMATION */</span>
                <span class="keywordflow">if</span> (newIns-&gt;<a class="code" href="classinstruction.html#a47623362d505a662b974624f81288389">getType</a> () == <span class="charliteral">&#39;j&#39;</span> || newIns-&gt;<a class="code" href="classinstruction.html#a47623362d505a662b974624f81288389">getType</a> () == <span class="charliteral">&#39;b&#39;</span> || newIns-&gt;<a class="code" href="classinstruction.html#a47623362d505a662b974624f81288389">getType</a> () == <span class="charliteral">&#39;c&#39;</span>) {
                        <span class="comment">/* SETUP BRANCH PREDICTION ACCURACY INFORMATION */</span>
<span class="comment">//                      if (bpAccuracyMap-&gt;find (insAddr) != bpAccuracyMap-&gt;end ()) {</span>
<span class="comment">//                              newIns-&gt;setBPaccuracy ((*bpAccuracyMap)[insAddr]);</span>
<span class="comment">//                      } else if (newIns-&gt;getType () == &#39;b&#39;) {</span>
<span class="comment">//                              ;// printf (&quot;\t\tERROR: branch instruction prediction accuracy not found! (%s, line: %d)\n&quot; , __FILE__, __LINE__);</span>
<span class="comment">//                              //exit (1);</span>
<span class="comment">//                      }</span>

                        <span class="comment">/* SETUP BRANCH BIAS INFORMATION */</span>
                        <span class="keywordflow">if</span> (brBiasMap-&gt;find (insAddr) != brBiasMap-&gt;end ()) {
                                newIns-&gt;<a class="code" href="classinstruction.html#aabc818127836c8403b9c691985ca6d14">setBrTakenBias</a> ((*brBiasMap)[insAddr]);
                        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (newIns-&gt;<a class="code" href="classinstruction.html#a47623362d505a662b974624f81288389">getType</a> () == <span class="charliteral">&#39;b&#39;</span>) {
                                ;<span class="comment">// printf (&quot;\t\tERROR: branch instruction bias not found! (%s, line: %d)\n&quot; , __FILE__, __LINE__);</span>
                                <span class="comment">//exit (1);</span>
                        }
                }

        <span class="keywordflow">if</span> (newIns-&gt;<a class="code" href="classinstruction.html#a47623362d505a662b974624f81288389">getType</a> () == <span class="charliteral">&#39;M&#39;</span>) {
                        <span class="keywordflow">if</span> (memRdAddrMap.find (insAddr) != memRdAddrMap.end ()) {
                                newIns-&gt;<a class="code" href="classinstruction.html#a379cbb0fb6bbe15168c6eac05a37114f">setRdAddrSet</a> (memRdAddrMap[insAddr]);
                        } 
                        <span class="keywordflow">if</span> (memWrAddrMap.find (insAddr) != memWrAddrMap.end ()) {
                                newIns-&gt;<a class="code" href="classinstruction.html#a8928d9fe638fd7307606fac71a31b681">setWrAddrSet</a> (memWrAddrMap[insAddr]);
                        }
                }

                <span class="comment">/* SET MISS-RATE IF INSTRUCTION IS A UPLD */</span>
                <span class="keywordflow">if</span> (upldMap-&gt;find (insAddr) != upldMap-&gt;end () &amp;&amp; newIns-&gt;<a class="code" href="classinstruction.html#abf5f8947b16c91c4e21b82bec378008f">isRdMemType</a> () == <span class="keyword">true</span>) {
                        newIns-&gt;<a class="code" href="classinstruction.html#a5052a04bf5db0d0e1519eb54f343bdc6">setLdMissRate</a> ((*upldMap)[insAddr]);
            newIns-&gt;<a class="code" href="classinstruction.html#adcf44cfcb7a8c267da71a1ef7b2f4b91">setUPLDins</a> ();
                }

                <span class="comment">/* SET INSTRUCTION REGISTERS (READ &amp; WRITE) */</span>
                <a class="code" href="make__instruction_8cpp.html#a1985023947a640496fdfa3654d726c9a">parseRegisters</a> (newIns, input_assembly);
                <span class="comment">// newIns-&gt;setOpCode (opCode); done somewhere else</span>
                insList-&gt;<a class="code" href="classList.html#a473190098e38206d0125b0737245e613">Append</a> (newIns);
                insAddrMap-&gt;insert (pair&lt;ADDR, instruction*&gt; (newIns-&gt;<a class="code" href="classinstruction.html#ac1fabe854c85726785052c7a5ebf6d39">getInsAddr</a> (), newIns));
        }

    
    <span class="comment">/* </span>
<span class="comment">     * - IF AN INSTRUCTION NEXT INS IS NOT IN THE INSLIST, CLEAN THE INS ENTRIED</span>
<span class="comment">     * - THIS CLEANS UP THE DESTINATION OF CALL INSTRUCTIONS</span>
<span class="comment">     */</span>
    <span class="keywordtype">int</span> num_missing_ins = 0;
    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; insList-&gt;<a class="code" href="classList.html#ac2e9d50f703b01bf643fa6ce50837c26">NumElements</a> (); i++) {
        <a class="code" href="binaryTranslator_2global_8h.html#a8bb6b77b3aab51e3a8d1866dd5861225">ADDR</a> dst, fallThru;
        <a class="code" href="classinstruction.html">instruction</a>* ins = insList-&gt;<a class="code" href="classList.html#a5eb964816de33c85e1d46658ddf8c6c4">Nth</a> (i);
        <span class="keywordflow">if</span> (ins-&gt;<a class="code" href="classinstruction.html#ac0f0a724c1207fd9c2aad8897f3c9842">hasDst</a> ()) {
            dst = ins-&gt;<a class="code" href="classinstruction.html#a600fd1454a34eca9a64057e3c019a795">getInsDstAddr</a> ();
            <span class="keywordflow">if</span> (insAddrMap-&gt;find (dst) == insAddrMap-&gt;end ()) {
                ins-&gt;<a class="code" href="classinstruction.html#aadbc60fe35dec68a1a8589cfc9fcc022">resetInsDst</a> (); num_missing_ins++;
            }
        }
        <span class="keywordflow">if</span> (ins-&gt;<a class="code" href="classinstruction.html#a2d7b01a0443263782d84906eb8c35ccc">hasFallThru</a> ()) {
            fallThru = ins-&gt;<a class="code" href="classinstruction.html#a6b94ce0e75e6676de23c2a87a19eecd3">getInsFallThruAddr</a> ();
            <span class="keywordflow">if</span> (insAddrMap-&gt;find (fallThru) == insAddrMap-&gt;end ()) {
                ins-&gt;<a class="code" href="classinstruction.html#ac796f0f05fa4011d7c05c2155020c5bb">resetInsFallThru</a> (); num_missing_ins++;
            }
        }
    }
        printf (<span class="stringliteral">&quot;\t\tWARNING: Number of missing instructions in insList: %d\n&quot;</span>, num_missing_ins);

    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; insList-&gt;<a class="code" href="classList.html#ac2e9d50f703b01bf643fa6ce50837c26">NumElements</a> (); i++) {
        <a class="code" href="binaryTranslator_2global_8h.html#a8bb6b77b3aab51e3a8d1866dd5861225">ADDR</a> dst, fallThru;
        <a class="code" href="classinstruction.html">instruction</a>* ins = insList-&gt;<a class="code" href="classList.html#a5eb964816de33c85e1d46658ddf8c6c4">Nth</a> (i);

        <span class="comment">/* FIND DESTINATION POINTERS */</span>
        <span class="keywordflow">if</span> (ins-&gt;<a class="code" href="classinstruction.html#ac0f0a724c1207fd9c2aad8897f3c9842">hasDst</a> ()) {
            dst = ins-&gt;<a class="code" href="classinstruction.html#a600fd1454a34eca9a64057e3c019a795">getInsDstAddr</a> ();
            <a class="code" href="binaryTranslator_2frontend_2utility_8h.html#aab1e54dcc40192f9704e8b252635450f">Assert</a> (insAddrMap-&gt;find (dst) != insAddrMap-&gt;end ());
            <a class="code" href="classinstruction.html">instruction</a>* dst_ins = (*insAddrMap)[dst];
            ins-&gt;<a class="code" href="classinstruction.html#a7cd565022bab4e05dfe1e0b4637731d5">setInsDst</a> (dst_ins);
        }

        <span class="comment">/* FIND FALL-THROUGH POINTERS */</span>
        <span class="keywordflow">if</span> (ins-&gt;<a class="code" href="classinstruction.html#a2d7b01a0443263782d84906eb8c35ccc">hasFallThru</a> ()) {
            fallThru = ins-&gt;<a class="code" href="classinstruction.html#a6b94ce0e75e6676de23c2a87a19eecd3">getInsFallThruAddr</a> ();
            <a class="code" href="binaryTranslator_2frontend_2utility_8h.html#aab1e54dcc40192f9704e8b252635450f">Assert</a> (insAddrMap-&gt;find (fallThru) != insAddrMap-&gt;end ());
            <a class="code" href="classinstruction.html">instruction</a>* fallThru_ins = (*insAddrMap)[fallThru];
            ins-&gt;<a class="code" href="classinstruction.html#afb8fdf4968223005eaf2eb18709f2ce5">setInsFallThru</a> (fallThru_ins);
        }
    }

        <span class="comment">/* CLOSE FILES */</span>
        fclose (input_assembly);
    <span class="keywordflow">if</span> (input_brBias != NULL) { fclose (input_brBias); }
<span class="comment">//      fclose (input_bpAccuracy);</span>
    <span class="keywordflow">if</span> (input_upld != NULL) { fclose (input_upld); }
        fclose (input_mem);
}
</pre></div>
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="make__instruction_8cpp_abe7a2d116e3e54c66d70fff6e83b0bae_cgraph.png" border="0" usemap="#make__instruction_8cpp_abe7a2d116e3e54c66d70fff6e83b0bae_cgraph" alt=""/></div>
<map name="make__instruction_8cpp_abe7a2d116e3e54c66d70fff6e83b0bae_cgraph" id="make__instruction_8cpp_abe7a2d116e3e54c66d70fff6e83b0bae_cgraph">
</map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="make__instruction_8cpp_abe7a2d116e3e54c66d70fff6e83b0bae_icgraph.png" border="0" usemap="#make__instruction_8cpp_abe7a2d116e3e54c66d70fff6e83b0bae_icgraph" alt=""/></div>
<map name="make__instruction_8cpp_abe7a2d116e3e54c66d70fff6e83b0bae_icgraph" id="make__instruction_8cpp_abe7a2d116e3e54c66d70fff6e83b0bae_icgraph">
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a1985023947a640496fdfa3654d726c9a"></a><!-- doxytag: member="make_instruction.cpp::parseRegisters" ref="a1985023947a640496fdfa3654d726c9a" args="(instruction *newIns, FILE *input_assembly)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void parseRegisters </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classinstruction.html">instruction</a> *&#160;</td>
          <td class="paramname"><em>newIns</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">FILE *&#160;</td>
          <td class="paramname"><em>input_assembly</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<div class="fragment"><pre class="fragment">                                                                {
        <a class="code" href="classregFile.html">regFile</a>* RF = <span class="keyword">new</span> <a class="code" href="classregFile.html">regFile</a>;
        <span class="keywordtype">char</span> reg[<a class="code" href="binaryTranslator_2global_8h.html#a3088356e3c44bedd210a9cc28246cf82">REG_STRING_SIZE</a>];
        <span class="keywordtype">int</span> read_write = 0;
        <span class="keywordtype">long</span> <span class="keywordtype">int</span> regCode, specialRegCode;

        <span class="keywordflow">while</span> (<span class="keyword">true</span>) {
                <span class="keywordflow">if</span> (fgets (reg, <a class="code" href="binaryTranslator_2global_8h.html#a3088356e3c44bedd210a9cc28246cf82">REG_STRING_SIZE</a>, input_assembly) == NULL) 
            <a class="code" href="binaryTranslator_2frontend_2utility_8h.html#aab1e54dcc40192f9704e8b252635450f">Assert</a> (0 &amp;&amp; <span class="stringliteral">&quot;Register name not found&quot;</span>);
                <span class="keywordflow">if</span> (reg[0] == <span class="charliteral">&#39;-&#39;</span>) <span class="keywordflow">break</span>; <span class="comment">//SOME OPS HAVE NO REG</span>

                <span class="keywordflow">if</span> (fscanf (input_assembly, <span class="stringliteral">&quot;%d\n&quot;</span>, &amp;read_write) == EOF) 
            <a class="code" href="binaryTranslator_2frontend_2utility_8h.html#aab1e54dcc40192f9704e8b252635450f">Assert</a> (0 &amp;&amp; <span class="stringliteral">&quot;Register type not found&quot;</span>);
                reg[strlen (reg) - 1] = 0; <span class="comment">//CUT OUT NEWLINE</span>

                regCode = RF-&gt;<a class="code" href="classregFile.html#a8e27b1edd7cbb6d8820a73fb1d7d8c71">getRegNum</a> (reg);
                specialRegCode = RF-&gt;<a class="code" href="classregFile.html#aa00f4bf6c12df40865e52c6ea1f040be">getSpecialRegNum</a> (reg);
        <a class="code" href="binaryTranslator_2frontend_2utility_8h.html#aab1e54dcc40192f9704e8b252635450f">Assert</a> ((regCode == <a class="code" href="binaryTranslator_2global_8h.html#ac2e4520b753f883cd8050dbf1864db08">INVALID_REG</a> || specialRegCode == <a class="code" href="binaryTranslator_2global_8h.html#ac2e4520b753f883cd8050dbf1864db08">INVALID_REG</a>) &amp;&amp; 
                <span class="stringliteral">&quot;One of the two fields must return invalid&quot;</span>);

                <span class="keywordflow">if</span> (regCode != <a class="code" href="binaryTranslator_2global_8h.html#ac2e4520b753f883cd8050dbf1864db08">INVALID_REG</a>) {
                        newIns-&gt;<a class="code" href="classinstruction.html#a456de8aa26ff79d2b7cd203f7c59f2cb">setRegister</a> (&amp;regCode, &amp;read_write);
        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (specialRegCode != <a class="code" href="binaryTranslator_2global_8h.html#ac2e4520b753f883cd8050dbf1864db08">INVALID_REG</a>) {
                        newIns-&gt;<a class="code" href="classinstruction.html#ae171d8892a0c330d2fa475346e321724">setSpecialRegister</a> (&amp;specialRegCode, &amp;read_write);
        } <span class="keywordflow">else</span> {
            printf (<span class="stringliteral">&quot;\t\tWARNING: Unrecorgnized register %s\n&quot;</span>, reg);
        }
        }
        <span class="keyword">delete</span> RF;
}
</pre></div>
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="make__instruction_8cpp_a1985023947a640496fdfa3654d726c9a_cgraph.png" border="0" usemap="#make__instruction_8cpp_a1985023947a640496fdfa3654d726c9a_cgraph" alt=""/></div>
<map name="make__instruction_8cpp_a1985023947a640496fdfa3654d726c9a_cgraph" id="make__instruction_8cpp_a1985023947a640496fdfa3654d726c9a_cgraph">
</map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="make__instruction_8cpp_a1985023947a640496fdfa3654d726c9a_icgraph.png" border="0" usemap="#make__instruction_8cpp_a1985023947a640496fdfa3654d726c9a_icgraph" alt=""/></div>
<map name="make__instruction_8cpp_a1985023947a640496fdfa3654d726c9a_icgraph" id="make__instruction_8cpp_a1985023947a640496fdfa3654d726c9a_icgraph">
</map>
</div>
</p>

</div>
</div>
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address class="footer"><small>Generated on Mon Jul 13 2015 for PhArS by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </small></address>
</body>
</html>
