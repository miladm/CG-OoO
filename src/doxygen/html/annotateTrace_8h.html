<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>PhArS: /home/milad/esc_project/svn/PARS/src/binaryTranslator/annotateTrace.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.4 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">PhArS&#160;<span id="projectnumber">1</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">/home/milad/esc_project/svn/PARS/src/binaryTranslator/annotateTrace.h File Reference</div>  </div>
</div>
<div class="contents">
<div class="textblock"><code>#include &lt;string&gt;</code><br/>
<code>#include &lt;list&gt;</code><br/>
<code>#include &quot;basicblock.h&quot;</code><br/>
<code>#include &quot;instruction.h&quot;</code><br/>
</div>
<p><a href="annotateTrace_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="annotateTrace_8h.html#a1359aaee4cb6eba6fd6406cbc1f30773">annotateTrace_forBB</a> (<a class="el" href="classList.html">List</a>&lt; <a class="el" href="classbasicblock.html">basicblock</a> * &gt; *bbList, map&lt; <a class="el" href="binaryTranslator_2global_8h.html#aa4557b0650cb21e57e3e4623410832c6">ADDR</a>, <a class="el" href="classinstruction.html">instruction</a> * &gt; *insAddrMap, string *program_name)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="annotateTrace_8h.html#a3099323792a8316815c7adb8bc3aed50">annotateTrace_forPB</a> (<a class="el" href="classList.html">List</a>&lt; <a class="el" href="classbasicblock.html">basicblock</a> * &gt; *bbList, map&lt; <a class="el" href="binaryTranslator_2global_8h.html#aa4557b0650cb21e57e3e4623410832c6">ADDR</a>, <a class="el" href="classinstruction.html">instruction</a> * &gt; *insAddrMap, string *program_name)</td></tr>
</table>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a1359aaee4cb6eba6fd6406cbc1f30773"></a><!-- doxytag: member="annotateTrace.h::annotateTrace_forBB" ref="a1359aaee4cb6eba6fd6406cbc1f30773" args="(List&lt; basicblock * &gt; *bbList, map&lt; ADDR, instruction * &gt; *insAddrMap, string *program_name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void annotateTrace_forBB </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classList.html">List</a>&lt; <a class="el" href="classbasicblock.html">basicblock</a> * &gt; *&#160;</td>
          <td class="paramname"><em>bbList</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">map&lt; <a class="el" href="binaryTranslator_2global_8h.html#aa4557b0650cb21e57e3e4623410832c6">ADDR</a>, <a class="el" href="classinstruction.html">instruction</a> * &gt; *&#160;</td>
          <td class="paramname"><em>insAddrMap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string *&#160;</td>
          <td class="paramname"><em>program_name</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<div class="fragment"><pre class="fragment">                                                                                                               {
        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; bbList-&gt;<a class="code" href="classList.html#ac2e9d50f703b01bf643fa6ce50837c26">NumElements</a>(); i++) 
                <span class="keywordtype">int</span> size = bbList-&gt;<a class="code" href="classList.html#a5eb964816de33c85e1d46658ddf8c6c4">Nth</a>(i)-&gt;getBbSize();
        FILE *traceFileInput, *traceFileOutput;
        <span class="keywordflow">if</span> ((traceFileInput  = fopen((<span class="stringliteral">&quot;/scratch/tracesim/specint2006/&quot;</span>+(*program_name)+<span class="stringliteral">&quot;.trace&quot;</span>).c_str(), <span class="stringliteral">&quot;r&quot;</span>)) == NULL) <span class="comment">//TODO PARAMETRIZE this line</span>
                <a class="code" href="backend_2utility_8h.html#aab1e54dcc40192f9704e8b252635450f">Assert</a>(<span class="stringliteral">&quot;Unable to open the input file.&quot;</span>);
        <span class="keywordflow">if</span> ((traceFileOutput  = fopen((<span class="stringliteral">&quot;/scratch/tracesim/specint2006/bb_trace_archReg/&quot;</span>+(*program_name)+<span class="stringliteral">&quot;.trace&quot;</span>).c_str(), <span class="stringliteral">&quot;w&quot;</span>)) == NULL) <span class="comment">//TODO PARAMETRIZE this line</span>
                <a class="code" href="backend_2utility_8h.html#aab1e54dcc40192f9704e8b252635450f">Assert</a>(<span class="stringliteral">&quot;Unable to open the output file.&quot;</span>);
        map&lt;ADDR, basicblock*&gt; bbHeaders;
        map&lt;int, int&gt; bbSizeHist;

        <span class="comment">/* Create a list of program BB&#39;s for use later */</span>
        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i =  0; i &lt; bbList-&gt;<a class="code" href="classList.html#ac2e9d50f703b01bf643fa6ce50837c26">NumElements</a>(); i++) {
                <a class="code" href="classbasicblock.html">basicblock</a>* bb = bbList-&gt;<a class="code" href="classList.html#a5eb964816de33c85e1d46658ddf8c6c4">Nth</a>(i);
                bbHeaders.insert(pair&lt;ADDR, basicblock*&gt; (bb-&gt;<a class="code" href="classbasicblock.html#adc40d816c82feedc1f7027fc29470d90">getInsList</a>()-&gt;<a class="code" href="classList.html#a5eb964816de33c85e1d46658ddf8c6c4">Nth</a>(0)-&gt;<a class="code" href="classinstruction.html#ac1fabe854c85726785052c7a5ebf6d39">getInsAddr</a>(), bb));
        }

        <span class="comment">/* Walk through the trace */</span>
        <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> insCounter = 0, insSkipCounter = 0, bbSize = 0, printedInsCounter = 0, printedPhiInsCounter = 0;
        <a class="code" href="classList.html">List&lt;instruction*&gt;</a>* insList = <span class="keyword">new</span> <a class="code" href="classList.html">List&lt;instruction*&gt;</a>;
        <a class="code" href="binaryTranslator_2global_8h.html#aa4557b0650cb21e57e3e4623410832c6">ADDR</a> insAddr, brAddr, junk_addr, brDstAddr;
        <span class="keywordtype">bool</span> new_bb = <span class="keyword">false</span>, new_pb = <span class="keyword">false</span>;
        <a class="code" href="classbasicblock.html">basicblock</a> *currentBB = NULL, *prevBB = NULL;
        <span class="keywordtype">char</span> insType, junk_s[1000];
        map&lt;ADDR,string&gt; dynBBMap;
        <span class="keywordtype">int</span> brTaken = -1;
        <span class="comment">//Get rid of first line (blank line perhaps?)</span>
        <span class="keywordflow">if</span> (fgets (junk_s, 1000, traceFileInput) == NULL)
                <a class="code" href="backend_2utility_8h.html#aab1e54dcc40192f9704e8b252635450f">Assert</a>(<span class="stringliteral">&quot;Trace file is empty!&quot;</span>);
        <span class="keywordtype">bool</span> brFound = <span class="keyword">false</span>;
        fprintf(traceFileOutput, <span class="stringliteral">&quot;{\n&quot;</span>);
        <span class="keywordflow">while</span>((insType = fgetc (traceFileInput)) != EOF) {
                insCounter++;
                <span class="keywordflow">if</span> (insType == <span class="charliteral">&#39;R&#39;</span> || insType == <span class="charliteral">&#39;W&#39;</span>) {
                        <span class="comment">/* TODO put these two lines back */</span>
                        <span class="comment">// insType = &#39;M&#39;;</span>
                        <span class="keywordflow">if</span> (fscanf(traceFileInput, <span class="stringliteral">&quot;,%llu,%llu&quot;</span>, &amp;junk_addr, &amp;insAddr) == EOF) 
                                <a class="code" href="backend_2utility_8h.html#aab1e54dcc40192f9704e8b252635450f">Assert</a>(<span class="stringliteral">&quot;Invalid end of line detected in trace file.&quot;</span>);
                        <span class="keywordflow">if</span> (fgets (junk_s, 1000, traceFileInput) == NULL) <span class="keywordflow">break</span>; <span class="comment">//grab the rest of line</span>
                        <span class="comment">// Eliminate trace instructions that are not mapped in the CFG</span>
                        <span class="keywordflow">if</span> (insAddrMap-&gt;find(insAddr) == insAddrMap-&gt;end()) {
                                <a class="code" href="backend_2utility_8h.html#aab1e54dcc40192f9704e8b252635450f">Assert</a>(new_bb == <span class="keyword">false</span> &amp;&amp; <span class="stringliteral">&quot;Illegal value for new_bb flag.&quot;</span>);
                                insSkipCounter++;
                                <span class="keywordflow">continue</span>;
                                <span class="comment">// printf(&quot;skipping instruction %llx\n&quot;, insAddr);</span>
                        }
                        <span class="comment">//Find out if this ins belongs to new BB</span>
                        <span class="keywordflow">if</span> (bbHeaders.find(insAddr) != bbHeaders.end()) {
                                new_bb = <span class="keyword">true</span>;
                                prevBB = currentBB;
                                currentBB = bbHeaders[insAddr];
                        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (currentBB-&gt;<a class="code" href="classbasicblock.html#afd299af5d08655c4fbd10221f5edb556">isInsAddrInBB</a>(insAddr) == <span class="keyword">false</span>) {
                                new_bb = <span class="keyword">true</span>;
                                prevBB = currentBB;
                                currentBB = bbHeaders[((*insAddrMap)[insAddr])-&gt;getMy_BB_id()];
                        }
                } <span class="keywordflow">else</span> {
                        <span class="comment">/* TODO put these two lines back */</span>
                        <span class="comment">// if (insType == &#39;B&#39;) insType = &#39;b&#39;;</span>
                        <span class="comment">// else insType = &#39;o&#39;;</span>
                        <span class="keywordflow">if</span> (insType == <span class="charliteral">&#39;B&#39;</span>) {
                                <span class="keywordflow">if</span> (fscanf(traceFileInput, <span class="stringliteral">&quot;,%llu,%d,%llu&quot;</span>, &amp;insAddr, &amp;brTaken, &amp;brDstAddr) == EOF)
                                        <a class="code" href="backend_2utility_8h.html#aab1e54dcc40192f9704e8b252635450f">Assert</a>(<span class="stringliteral">&quot;Invalid end of line detected in trace file.&quot;</span>);
                        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (insType == <span class="charliteral">&#39;A&#39;</span> || insType == <span class="charliteral">&#39;F&#39;</span>) {
                                <span class="keywordflow">if</span> (fscanf(traceFileInput, <span class="stringliteral">&quot;,%llu&quot;</span>, &amp;insAddr) == EOF)
                                        <a class="code" href="backend_2utility_8h.html#aab1e54dcc40192f9704e8b252635450f">Assert</a>(<span class="stringliteral">&quot;Invalid end of line detected in trace file.&quot;</span>);
                        } <span class="keywordflow">else</span> {
                                <a class="code" href="backend_2utility_8h.html#aab1e54dcc40192f9704e8b252635450f">Assert</a>(<span class="stringliteral">&quot;Invalid Trace Instruction Type.&quot;</span>);
                        }
                        <span class="keywordflow">if</span> (fgets (junk_s, 1000, traceFileInput) == NULL) <span class="keywordflow">break</span>; <span class="comment">//grab the rest of line</span>
                        <span class="comment">// Eliminate trace instructions that are not mapped in the CFG</span>
                        <span class="keywordflow">if</span> (insAddrMap-&gt;find(insAddr) == insAddrMap-&gt;end()) {
                                <a class="code" href="backend_2utility_8h.html#aab1e54dcc40192f9704e8b252635450f">Assert</a>(new_bb == <span class="keyword">false</span> &amp;&amp; <span class="stringliteral">&quot;Illegal value for new_bb flag.&quot;</span>);
                                insSkipCounter++;
                                <span class="keywordflow">continue</span>;
                        }
                        <span class="comment">//Find out if this ins belongs to new BB</span>
                        <span class="keywordflow">if</span> (bbHeaders.find(insAddr) != bbHeaders.end()) {
                                new_bb = <span class="keyword">true</span>;
                                prevBB = currentBB;
                                currentBB = bbHeaders[insAddr];
                        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (currentBB-&gt;<a class="code" href="classbasicblock.html#afd299af5d08655c4fbd10221f5edb556">isInsAddrInBB</a>(insAddr) == <span class="keyword">false</span>) {
                                new_bb = <span class="keyword">true</span>;
                                prevBB = currentBB;
                                currentBB = bbHeaders[((*insAddrMap)[insAddr])-&gt;getMy_BB_id()];
                        }
                }
                <a class="code" href="backend_2utility_8h.html#aab1e54dcc40192f9704e8b252635450f">Assert</a>(currentBB-&gt;<a class="code" href="classbasicblock.html#afd299af5d08655c4fbd10221f5edb556">isInsAddrInBB</a>(insAddr) == <span class="keyword">true</span> &amp;&amp; <span class="stringliteral">&quot;Trace instruction does not belong to current BB.&quot;</span>);
                <span class="keywordflow">if</span> (new_bb) {
                        map&lt;ADDR,string&gt;::iterator it;
                        <span class="comment">// Print BB/PB Header</span>
                        <span class="keywordflow">if</span> (brFound == <span class="keyword">true</span>) {
                                fprintf(traceFileOutput, <span class="stringliteral">&quot;H,%llu\n&quot;</span>, brAddr);
                        }
                        <span class="comment">// Store BB/PB Ins&#39;s</span>
                        <span class="keywordflow">if</span> (prevBB == NULL) prevBB = currentBB; <span class="comment">//for first BB</span>
                        <span class="comment">// List&lt;instruction*&gt;* listSchBBList = prevBB-&gt;getInsList_ListSchedule();</span>
                        <a class="code" href="classList.html">List&lt;instruction*&gt;</a>* listSchBBList = prevBB-&gt;getInsList(); <span class="comment">//Replace this with above line for list-scheduling</span>
                        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; listSchBBList-&gt;<a class="code" href="classList.html#ac2e9d50f703b01bf643fa6ce50837c26">NumElements</a>(); i++) {
                                <span class="comment">// if (dynBBMap.find(listSchBBList-&gt;Nth(i)-&gt;getInsAddr()) == dynBBMap.end()) </span>
                                        <span class="comment">// printf(&quot;didn&#39;t find ins in map %d, %d, %d\n&quot;, dynBBMap.size(), listSchBBList-&gt;NumElements(), dynBBMap.size() &lt; listSchBBList-&gt;NumElements());</span>
                                <a class="code" href="backend_2utility_8h.html#aab1e54dcc40192f9704e8b252635450f">Assert</a> (listSchBBList-&gt;<a class="code" href="classList.html#a5eb964816de33c85e1d46658ddf8c6c4">Nth</a>(i)-&gt;<a class="code" href="classinstruction.html#ab5e9dd71fbc48781b528341a9a371a95">isAlreadyAssignedArcRegs</a>() == <span class="keyword">true</span>);
                                <span class="keywordflow">if</span> (listSchBBList-&gt;<a class="code" href="classList.html#a5eb964816de33c85e1d46658ddf8c6c4">Nth</a>(i)-&gt;<a class="code" href="classinstruction.html#ac1fabe854c85726785052c7a5ebf6d39">getInsAddr</a>() == <a class="code" href="binaryTranslator_2global_8h.html#a382722368f23110d49ee8908aac999f8">PHI_INS_ADDR</a>) {
                                        fprintf(traceFileOutput, <span class="stringliteral">&quot;A,%d,%d#%d,%d#%d,\n&quot;</span>, <a class="code" href="binaryTranslator_2global_8h.html#a382722368f23110d49ee8908aac999f8">PHI_INS_ADDR</a>,listSchBBList-&gt;<a class="code" href="classList.html#a5eb964816de33c85e1d46658ddf8c6c4">Nth</a>(i)-&gt;<a class="code" href="classinstruction.html#a7d49a66c0f3b426f1cf8fd335a5f3b6a">getNthArchReg</a>(0),listSchBBList-&gt;<a class="code" href="classList.html#a5eb964816de33c85e1d46658ddf8c6c4">Nth</a>(i)-&gt;<a class="code" href="classinstruction.html#a9701f53aafaf1b2298378665059cef33">getNthRegType</a>(0),listSchBBList-&gt;<a class="code" href="classList.html#a5eb964816de33c85e1d46658ddf8c6c4">Nth</a>(i)-&gt;<a class="code" href="classinstruction.html#a7d49a66c0f3b426f1cf8fd335a5f3b6a">getNthArchReg</a>(1),listSchBBList-&gt;<a class="code" href="classList.html#a5eb964816de33c85e1d46658ddf8c6c4">Nth</a>(i)-&gt;<a class="code" href="classinstruction.html#a9701f53aafaf1b2298378665059cef33">getNthRegType</a>(1));
                                        printedInsCounter++;
                                        printedPhiInsCounter++;
                                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dynBBMap.find(listSchBBList-&gt;<a class="code" href="classList.html#a5eb964816de33c85e1d46658ddf8c6c4">Nth</a>(i)-&gt;<a class="code" href="classinstruction.html#ac1fabe854c85726785052c7a5ebf6d39">getInsAddr</a>()) != dynBBMap.end()) {
                                        fprintf(traceFileOutput, <span class="stringliteral">&quot;%s&quot;</span>, (dynBBMap[listSchBBList-&gt;<a class="code" href="classList.html#a5eb964816de33c85e1d46658ddf8c6c4">Nth</a>(i)-&gt;<a class="code" href="classinstruction.html#ac1fabe854c85726785052c7a5ebf6d39">getInsAddr</a>()]).c_str());
                                        printedInsCounter++;
                                }
                        }
                        <span class="comment">// for (it = dynBBMap.begin(); it != dynBBMap.end(); it++) {</span>
                        <span class="comment">//      fprintf(traceFileOutput, &quot;%s&quot;, (it-&gt;second).c_str());</span>
                        <span class="comment">// } For storing exatly what comes out of trace (with no list scheduling)</span>
                        fprintf(traceFileOutput, <span class="stringliteral">&quot;}\n{\n&quot;</span>);
                        new_bb = <span class="keyword">false</span>;
                        brFound = <span class="keyword">false</span>;
                        bbSizeHist[bbSize]++;
                        bbSize = 0;
                        dynBBMap.clear();
                }
                bbSize++;
                <span class="comment">// Construct ins string &amp; store in ins-map</span>
                std::stringstream ss1, ss2;
                <span class="keywordtype">string</span> registers = ((*insAddrMap)[insAddr])-&gt;getArchRegisterStr();
                <span class="keywordflow">if</span> (insType == <span class="charliteral">&#39;R&#39;</span> || insType == <span class="charliteral">&#39;W&#39;</span>) {
                        ss1 &lt;&lt; insType &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; junk_addr &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; insAddr &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; registers;
                        <span class="comment">// ss1 &lt;&lt; insType &lt;&lt; &quot;,&quot; &lt;&lt; junk_addr &lt;&lt; &quot;,&quot; &lt;&lt; insAddr &lt;&lt; junk_s; (original reg names)</span>
                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (insType == <span class="charliteral">&#39;B&#39;</span>) {
                        ss1 &lt;&lt; insType &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; insAddr &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; brTaken &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; brDstAddr &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; registers;
                        <span class="comment">// ss1 &lt;&lt; insType &lt;&lt; &quot;,&quot; &lt;&lt; insAddr &lt;&lt; &quot;,&quot; &lt;&lt; brTaken &lt;&lt; &quot;,&quot; &lt;&lt; brDstAddr &lt;&lt; junk_s; (original reg names)</span>
                } <span class="keywordflow">else</span> { <span class="comment">//A &amp; F for insType</span>
                        ss1 &lt;&lt; insType &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; insAddr &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; registers;
                        <span class="comment">// ss1 &lt;&lt; insType &lt;&lt; &quot;,&quot; &lt;&lt; insAddr &lt;&lt; junk_s; (original reg names)</span>
                }
                std::string s = ss1.str();
                <span class="keywordflow">if</span> (dynBBMap.find(insAddr) != dynBBMap.end()) {
                        <span class="comment">//Trace runs micro-ops, so it can have ins-addr replicas</span>
                        <span class="keywordtype">string</span> t = dynBBMap[insAddr];
                        ss2 &lt;&lt; t &lt;&lt; s;
                        s = ss2.str();
                        dynBBMap[insAddr] = s;
                } <span class="keywordflow">else</span> {
                        dynBBMap.insert(pair&lt;ADDR,string&gt; (insAddr,s));
                }
                <span class="comment">// Crearte basicblock headers</span>
                <span class="keywordflow">if</span> (insType == <span class="charliteral">&#39;B&#39;</span>) {
                        <span class="keywordflow">if</span> (brFound != <span class="keyword">false</span>) printf(<span class="stringliteral">&quot;%llu\n&quot;</span>, brAddr);
                        <a class="code" href="backend_2utility_8h.html#aab1e54dcc40192f9704e8b252635450f">Assert</a>(brFound == <span class="keyword">false</span> &amp;&amp; <span class="stringliteral">&quot;Illegal value for brFound variable.&quot;</span>);
                        brFound = <span class="keyword">true</span>;
                        brAddr = insAddr;
                }
        }
        <span class="keywordflow">if</span> (brFound) {
                fprintf(traceFileOutput, <span class="stringliteral">&quot;H:%llu\n&quot;</span>, brAddr);
                brFound = <span class="keyword">false</span>;
        }
        bbSizeHist[bbSize]++;
        fprintf(traceFileOutput, <span class="stringliteral">&quot;}\n&quot;</span>);
        printf(<span class="stringliteral">&quot;\tNumber of Trace Instructions Skipped: %lld (out of %lld)\n&quot;</span>, insSkipCounter, insCounter);
        printf(<span class="stringliteral">&quot;\tNumber of Trace Instructions Printed: %lld (out of %lld)\n&quot;</span>, printedInsCounter, insCounter-insSkipCounter);
        printf(<span class="stringliteral">&quot;\tNumber of Trace Phi Instructions Printed: %lld (out of %lld)\n&quot;</span>, printedPhiInsCounter, insCounter-printedPhiInsCounter);
        <a class="code" href="binaryTranslator_2stat_8cpp.html#ab157f0e7c21ee60b5b4212d99e5cfa48">DynBBSizeStat</a>(bbSizeHist, program_name);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a3099323792a8316815c7adb8bc3aed50"></a><!-- doxytag: member="annotateTrace.h::annotateTrace_forPB" ref="a3099323792a8316815c7adb8bc3aed50" args="(List&lt; basicblock * &gt; *bbList, map&lt; ADDR, instruction * &gt; *insAddrMap, string *program_name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void annotateTrace_forPB </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classList.html">List</a>&lt; <a class="el" href="classbasicblock.html">basicblock</a> * &gt; *&#160;</td>
          <td class="paramname"><em>bbList</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">map&lt; <a class="el" href="binaryTranslator_2global_8h.html#aa4557b0650cb21e57e3e4623410832c6">ADDR</a>, <a class="el" href="classinstruction.html">instruction</a> * &gt; *&#160;</td>
          <td class="paramname"><em>insAddrMap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string *&#160;</td>
          <td class="paramname"><em>program_name</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<div class="fragment"><pre class="fragment">                                                                                                               {
        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; pbList-&gt;NumElements(); i++) 
                <span class="keywordtype">int</span> size = pbList-&gt;Nth(i)-&gt;getBbSize();
        FILE *traceFileInput, *traceFileOutput;
        <span class="keywordflow">if</span> ((traceFileInput  = fopen((<span class="stringliteral">&quot;/scratch/tracesim/specint2006/&quot;</span>+(*program_name)+<span class="stringliteral">&quot;.trace&quot;</span>).c_str(), <span class="stringliteral">&quot;r&quot;</span>)) == NULL)
                <a class="code" href="backend_2utility_8h.html#aab1e54dcc40192f9704e8b252635450f">Assert</a>(<span class="stringliteral">&quot;Unable to open the input file.&quot;</span>);
        <span class="keywordflow">if</span> ((traceFileOutput  = fopen((<span class="stringliteral">&quot;/scratch/tracesim/specint2006/bb_trace/&quot;</span>+(*program_name)+<span class="stringliteral">&quot;_pb.trace&quot;</span>).c_str(), <span class="stringliteral">&quot;w&quot;</span>)) == NULL)
                <a class="code" href="backend_2utility_8h.html#aab1e54dcc40192f9704e8b252635450f">Assert</a>(<span class="stringliteral">&quot;Unable to open the output file.&quot;</span>);
        map&lt;ADDR, basicblock*&gt; bbHeaders;
        map&lt;ADDR, list&lt;basicblock*&gt; &gt; pbHeaders;
        map&lt;int, int&gt; bbSizeHist;

        <span class="comment">/* Create a list of program BB&#39;s for use later */</span>
        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i =  0; i &lt; pbList-&gt;NumElements(); i++) {
                <a class="code" href="classbasicblock.html">basicblock</a>* bb = pbList-&gt;Nth(i);
                <span class="keywordflow">if</span> (bb-&gt;<a class="code" href="classbasicblock.html#a88276960d345d6849dbe02c9debbb94e">isAPhraseblock</a>()) {
                        printf(<span class="stringliteral">&quot;found Phraseblock\n&quot;</span>);
                        <span class="keywordflow">if</span> (pbHeaders.find(bb-&gt;<a class="code" href="classbasicblock.html#adc40d816c82feedc1f7027fc29470d90">getInsList</a>()-&gt;<a class="code" href="classList.html#a5eb964816de33c85e1d46658ddf8c6c4">Nth</a>(0)-&gt;<a class="code" href="classinstruction.html#ac1fabe854c85726785052c7a5ebf6d39">getInsAddr</a>()) != pbHeaders.end()) {
                                (pbHeaders[bb-&gt;<a class="code" href="classbasicblock.html#adc40d816c82feedc1f7027fc29470d90">getInsList</a>()-&gt;<a class="code" href="classList.html#a5eb964816de33c85e1d46658ddf8c6c4">Nth</a>(0)-&gt;<a class="code" href="classinstruction.html#ac1fabe854c85726785052c7a5ebf6d39">getInsAddr</a>()]).push_back(bb);
                        } <span class="keywordflow">else</span> {
                                list&lt;basicblock*&gt; lst;
                                lst.push_back(bb);
                                pbHeaders.insert(pair&lt;<a class="code" href="binaryTranslator_2global_8h.html#aa4557b0650cb21e57e3e4623410832c6">ADDR</a>, list&lt;basicblock*&gt; &gt; (bb-&gt;<a class="code" href="classbasicblock.html#adc40d816c82feedc1f7027fc29470d90">getInsList</a>()-&gt;<a class="code" href="classList.html#a5eb964816de33c85e1d46658ddf8c6c4">Nth</a>(0)-&gt;<a class="code" href="classinstruction.html#ac1fabe854c85726785052c7a5ebf6d39">getInsAddr</a>(), lst));
                        }
                } <span class="keywordflow">else</span> {
                        bbHeaders.insert(pair&lt;ADDR, basicblock*&gt; (bb-&gt;<a class="code" href="classbasicblock.html#adc40d816c82feedc1f7027fc29470d90">getInsList</a>()-&gt;<a class="code" href="classList.html#a5eb964816de33c85e1d46658ddf8c6c4">Nth</a>(0)-&gt;<a class="code" href="classinstruction.html#ac1fabe854c85726785052c7a5ebf6d39">getInsAddr</a>(), bb));
                }
        }

        <span class="comment">/* Walk through the trace */</span>
        <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> insCounter = 0, insSkipCounter = 0, bbSize = 0, printedInsCounter = 0;
        <a class="code" href="classList.html">List&lt;instruction*&gt;</a>* insList = <span class="keyword">new</span> <a class="code" href="classList.html">List&lt;instruction*&gt;</a>;
        <a class="code" href="binaryTranslator_2global_8h.html#aa4557b0650cb21e57e3e4623410832c6">ADDR</a> insAddr, brAddr, junk_addr, brDstAddr, bbAddr, prevBbAddr;
        <span class="keywordtype">bool</span> new_bb = <span class="keyword">false</span>, new_pb = <span class="keyword">false</span>;
        <a class="code" href="classbasicblock.html">basicblock</a> *currentBB = NULL, *prevBB = NULL;
        <span class="comment">// List&lt;basicblock*&gt; *bb_list = new List&lt;basicblock*&gt;;</span>
        <span class="comment">// List&lt;ADDR&gt; br_addr_list    = new List&lt;ADDR&gt;;</span>
        <span class="comment">// List&lt;bool&gt; br_found_list   = new List&lt;bool&gt;;</span>
        <span class="comment">// List&lt;int&gt; bb_size_list     = new List&lt;int&gt;;</span>
        <span class="keywordtype">char</span> insType, junk_s[1000];
        map&lt;ADDR,string&gt; dynBBMap;
        <a class="code" href="classList.html">List&lt;map&lt;ADDR,string&gt;</a> &gt;* dynBBList = <span class="keyword">new</span> <a class="code" href="classList.html">List&lt;map&lt;ADDR,string&gt;</a> &gt;;
        map&lt;ADDR, basicblock*&gt; statBBListMap;
        list&lt;ADDR&gt; dynBBAddrList;
        map&lt;ADDR, bool&gt; brFoundMap;
        map&lt;ADDR, ADDR&gt; brAddrMap;
        <span class="keywordtype">int</span> brTaken = -1;
        <span class="comment">//Get rif of first line (blank line perhaps?)</span>
        <span class="keywordflow">if</span> (fgets (junk_s, 1000, traceFileInput) == NULL)
                <a class="code" href="backend_2utility_8h.html#aab1e54dcc40192f9704e8b252635450f">Assert</a>(<span class="stringliteral">&quot;Trace file is empty!&quot;</span>);
        <span class="keywordtype">bool</span> brFound = <span class="keyword">false</span>;
        fprintf(traceFileOutput, <span class="stringliteral">&quot;{\n&quot;</span>);
        <span class="keywordflow">while</span>((insType = fgetc (traceFileInput)) != EOF) {
                insCounter++;
                <span class="keywordflow">if</span> (insCounter % 10000 == 0) printf(<span class="stringliteral">&quot;ins count: %d\n&quot;</span>, insCounter);
                <span class="keywordflow">if</span> (insType == <span class="charliteral">&#39;R&#39;</span> || insType == <span class="charliteral">&#39;W&#39;</span>) {
                        <span class="comment">/* TODO put these two lines back */</span>
                        <span class="comment">// insType = &#39;M&#39;;</span>
                        <span class="keywordflow">if</span> (fscanf(traceFileInput, <span class="stringliteral">&quot;,%llu,%llu&quot;</span>, &amp;junk_addr, &amp;insAddr) == EOF) 
                                <a class="code" href="backend_2utility_8h.html#aab1e54dcc40192f9704e8b252635450f">Assert</a>(<span class="stringliteral">&quot;Invalid end of line detected in trace file.&quot;</span>);
                } <span class="keywordflow">else</span> {
                        <span class="comment">/* TODO put these two lines back */</span>
                        <span class="comment">// if (insType == &#39;B&#39;) insType = &#39;b&#39;;</span>
                        <span class="comment">// else insType = &#39;o&#39;;</span>
                        <span class="keywordflow">if</span> (insType == <span class="charliteral">&#39;B&#39;</span>) {
                                <span class="keywordflow">if</span> (fscanf(traceFileInput, <span class="stringliteral">&quot;,%llu,%d,%llu&quot;</span>, &amp;insAddr, &amp;brTaken, &amp;brDstAddr) == EOF)
                                        <a class="code" href="backend_2utility_8h.html#aab1e54dcc40192f9704e8b252635450f">Assert</a>(<span class="stringliteral">&quot;Invalid end of line detected in trace file.&quot;</span>);
                        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (insType == <span class="charliteral">&#39;A&#39;</span> || insType == <span class="charliteral">&#39;F&#39;</span>) {
                                <span class="keywordflow">if</span> (fscanf(traceFileInput, <span class="stringliteral">&quot;,%llu&quot;</span>, &amp;insAddr) == EOF)
                                        <a class="code" href="backend_2utility_8h.html#aab1e54dcc40192f9704e8b252635450f">Assert</a>(<span class="stringliteral">&quot;Invalid end of line detected in trace file.&quot;</span>);
                        } <span class="keywordflow">else</span> {
                                <a class="code" href="backend_2utility_8h.html#aab1e54dcc40192f9704e8b252635450f">Assert</a>(<span class="stringliteral">&quot;Invalid Trace Instruction Type.&quot;</span>);
                        }
                }
                <span class="keywordflow">if</span> (fgets (junk_s, 1000, traceFileInput) == NULL) <span class="keywordflow">break</span>; <span class="comment">//grab the rest of line</span>
                <span class="comment">// Eliminate trace instructions that are not mapped in the CFG</span>
                <span class="keywordflow">if</span> (insAddrMap-&gt;find(insAddr) == insAddrMap-&gt;end()) {
                        <a class="code" href="backend_2utility_8h.html#aab1e54dcc40192f9704e8b252635450f">Assert</a>(new_bb == <span class="keyword">false</span> &amp;&amp; <span class="stringliteral">&quot;Illegal value for new_bb flag.&quot;</span>);
                        insSkipCounter++;
                        <span class="keywordflow">continue</span>;
                        <span class="comment">// printf(&quot;skipping instruction %llx\n&quot;, insAddr);</span>
                }
                <span class="comment">//Find out if this ins belongs to new BB</span>
                <span class="keywordflow">if</span> (bbHeaders.find(insAddr) != bbHeaders.end()) {
                        new_bb = <span class="keyword">true</span>;
                        prevBbAddr = bbAddr;
                        bbAddr = insAddr;
                        prevBB = currentBB;
                        currentBB = bbHeaders[insAddr];
                        <span class="keywordflow">if</span> (pbHeaders.find(insAddr) != pbHeaders.end()) {
                                <span class="comment">// Assert(new_pb == false);</span>
                                <span class="comment">// currentPB = pbHeaders[insAddr];</span>
                                new_pb = <span class="keyword">true</span>;
                        }
                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (currentBB-&gt;<a class="code" href="classbasicblock.html#afd299af5d08655c4fbd10221f5edb556">isInsAddrInBB</a>(insAddr) == <span class="keyword">false</span>) {
                        new_bb = <span class="keyword">true</span>;
                        prevBbAddr = bbAddr;
                        bbAddr = ((*insAddrMap)[insAddr])-&gt;getMy_BB_id();
                        prevBB = currentBB;
                        currentBB = bbHeaders[((*insAddrMap)[insAddr])-&gt;getMy_BB_id()];
                        <span class="keywordflow">if</span> (pbHeaders.find(insAddr) != pbHeaders.end()) {
                        <span class="comment">//      Assert(new_pb == false);</span>
                        <span class="comment">//      // currentPB = pbHeaders[((*insAddrMap)[insAddr])-&gt;getMy_PB_id()];</span>
                        <span class="comment">//      currentPB = ((*insAddrMap)[insAddr])-&gt;getMy_PB_id();</span>
                                new_pb = <span class="keyword">true</span>; <span class="comment">//TODO is this condution check valid? take care of it when building phraeblocks</span>
                        }
                }
                
                <a class="code" href="backend_2utility_8h.html#aab1e54dcc40192f9704e8b252635450f">Assert</a>(currentBB-&gt;<a class="code" href="classbasicblock.html#afd299af5d08655c4fbd10221f5edb556">isInsAddrInBB</a>(insAddr) == <span class="keyword">true</span> &amp;&amp; <span class="stringliteral">&quot;Trace instruction does not belong to current BB.&quot;</span>);
                
                <span class="keywordflow">if</span> (new_bb) {
                        <span class="keywordflow">if</span> (dynBBAddrList.size() &gt;= 20) {
                                <span class="keywordflow">if</span> (pbHeaders.find(dynBBAddrList.front()) != pbHeaders.end()) {<span class="comment">//a phraseblock header?</span>
                                        <span class="comment">// printf(&quot;found PB?\n&quot;);</span>
                                        list&lt;basicblock*&gt; candidatePBs = pbHeaders.find(dynBBAddrList.front())-&gt;second;
                                        <span class="keywordtype">bool</span> pbDetected = <span class="keyword">false</span>;
                                        <span class="comment">//Match a candidate PB to the list of trace BB&#39;s in flight</span>
                                        <span class="keywordflow">for</span> (list&lt;basicblock*&gt;::iterator it = candidatePBs.begin(); it != candidatePBs.end(); it++) {
                                                <a class="code" href="classList.html">List&lt;ADDR&gt;</a>* bbHeadList = (*it)-&gt;getBBListForPB();
                                                pbDetected = <span class="keyword">true</span>;
                                                map&lt;ADDR, map&lt;ADDR,string&gt; &gt; listOfBBforPBMap;
                                                list&lt;ADDR&gt; listOfBBforPB;
                                                <span class="comment">//Cross-ref every BB with the trace BB&#39;s in flight</span>
                                                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; bbHeadList-&gt;<a class="code" href="classList.html#ac2e9d50f703b01bf643fa6ce50837c26">NumElements</a>(); i++) {
                                                        <span class="keywordtype">long</span> <span class="keywordtype">int</span> bbIndx = <a class="code" href="annotateTrace_8cpp.html#a1886834b5b714acdb0775054212d3db9">findBB</a>(bbHeadList-&gt;<a class="code" href="classList.html#a5eb964816de33c85e1d46658ddf8c6c4">Nth</a>(i), dynBBList);
                                                        <span class="keywordflow">if</span> (bbIndx == -1) {
                                                                pbDetected = <span class="keyword">false</span>;
                                                                <span class="keywordflow">break</span>;
                                                        } <span class="keywordflow">else</span> {
                                                                listOfBBforPBMap.insert(pair&lt;<a class="code" href="binaryTranslator_2global_8h.html#aa4557b0650cb21e57e3e4623410832c6">ADDR</a>, map&lt;ADDR,string&gt; &gt; (bbHeadList-&gt;<a class="code" href="classList.html#a5eb964816de33c85e1d46658ddf8c6c4">Nth</a>(i), dynBBList-&gt;<a class="code" href="classList.html#a5eb964816de33c85e1d46658ddf8c6c4">Nth</a>(bbIndx)));
                                                                listOfBBforPB.push_back(bbHeadList-&gt;<a class="code" href="classList.html#a5eb964816de33c85e1d46658ddf8c6c4">Nth</a>(i));
                                                        }
                                                }
                                                <span class="keywordflow">if</span> (pbDetected) {
                                                        <span class="comment">// printf(&quot;detected PB\n&quot;);</span>
                                                        <a class="code" href="classbasicblock.html">basicblock</a>* detectedPB = (*it);
                                                        <a class="code" href="annotateTrace_8cpp.html#a4ea14bccc7cc3ac11b499dcc35fddec8">storeToFile</a>(brFoundMap, brAddrMap, detectedPB, listOfBBforPBMap, traceFileOutput);
                                                        <span class="comment">// Clear processed BB&#39;s in map</span>
                                                        <span class="keywordflow">for</span> (list&lt;ADDR&gt;::iterator it2 = listOfBBforPB.begin(); it2 != listOfBBforPB.end(); it2++) {
                                                                <a class="code" href="annotateTrace_8cpp.html#afb131832ec53a28a9d071765d3c3a7e4">removeBB</a>(*it2, dynBBList);
                                                                <span class="keywordflow">for</span> (list&lt;ADDR&gt;::iterator it3 = dynBBAddrList.end(); it3 !=  dynBBAddrList.begin(); it3--)
                                                                        <span class="keywordflow">if</span> (*it3 == *it2) {
                                                                                dynBBAddrList.erase(it3);
                                                                                <span class="keywordflow">break</span>;
                                                                        }
                                                        }
                                                        <span class="keywordflow">break</span>;
                                                        <span class="comment">//do we break here?</span>
                                                }
                                        }
                                        <span class="keywordflow">if</span> (!pbDetected) {
                                                <span class="comment">// printf(&quot;didn&#39;t detect a phraseblock\n&quot;);</span>
                                                map&lt;ADDR,string&gt; bbMap = dynBBList-&gt;<a class="code" href="classList.html#a5eb964816de33c85e1d46658ddf8c6c4">Nth</a>(0);
                                                <span class="keywordflow">if</span> (bbMap.size() == 0) {printf(<span class="stringliteral">&quot; - size: %d\n&quot;</span>, bbMap.size());}
                                                printedInsCounter += <a class="code" href="annotateTrace_8cpp.html#a4ea14bccc7cc3ac11b499dcc35fddec8">storeToFile</a>(brFound, brAddr, (statBBListMap.find(dynBBAddrList.front()))-&gt;second, bbMap, traceFileOutput);
                                                dynBBList-&gt;<a class="code" href="classList.html#af17f72d263f90d53ea8501b5b1853470">RemoveAt</a>(0);<span class="comment">// dump the BB in the first spot </span>
                                                dynBBAddrList.pop_front();
                                        }
                                        <span class="comment">//search through the rest of list for finding a PB</span>
                                        <span class="comment">// if found, dump the BB&#39;s into a PB and move on</span>
                                        <span class="comment">// else dump the first BB</span>
                                } <span class="keywordflow">else</span> {
                                        map&lt;ADDR,string&gt; bbMap = dynBBList-&gt;<a class="code" href="classList.html#a5eb964816de33c85e1d46658ddf8c6c4">Nth</a>(0);
                                        <span class="keywordflow">if</span> (bbMap.size() == 0) {printf(<span class="stringliteral">&quot; - size: %d\n&quot;</span>, bbMap.size());}
                                        printedInsCounter += <a class="code" href="annotateTrace_8cpp.html#a4ea14bccc7cc3ac11b499dcc35fddec8">storeToFile</a>(brFound, brAddr, (statBBListMap.find(dynBBAddrList.front()))-&gt;second, bbMap, traceFileOutput);
                                        dynBBList-&gt;<a class="code" href="classList.html#af17f72d263f90d53ea8501b5b1853470">RemoveAt</a>(0);<span class="comment">// dump the BB in the first spot </span>
                                        dynBBAddrList.pop_front();
                                }
                        }
                        <span class="keywordflow">if</span> (prevBB == NULL) { <span class="comment">//for first BB</span>
                                prevBB = currentBB;
                                prevBbAddr = bbAddr;
                        }
                        <span class="keywordflow">if</span> (dynBBMap.size() &gt; 0) {
                                <span class="comment">// printf(&quot;REAR: %llx, %d, %d\n&quot;, prevBbAddr,dynBBAddrList.size(), dynBBMap.size());</span>
                                dynBBList-&gt;<a class="code" href="classList.html#a473190098e38206d0125b0737245e613">Append</a>(dynBBMap); <span class="comment">//map does not work here (addr replication :s)</span>
                                statBBListMap.insert(pair&lt;ADDR,basicblock*&gt; (prevBbAddr, prevBB));
                                dynBBAddrList.push_back(prevBbAddr);
                                brFoundMap.insert(pair&lt;ADDR,bool&gt; (prevBbAddr,brFound));
                                brAddrMap.insert(pair&lt;ADDR,ADDR&gt; (prevBbAddr,brAddr));
                        } <span class="keywordflow">else</span> {
                                printf(<span class="stringliteral">&quot;empty BB\n&quot;</span>);
                        }
                        brFound = <span class="keyword">false</span>;
                        bbSizeHist[bbSize]++;
                        dynBBMap.clear();
                        bbSize = 0; <span class="comment">//We are not measuring PB size here! (we can add values though)</span>
                        new_bb = <span class="keyword">false</span>;
                }
                bbSize++;
                <span class="comment">// Construct ins string &amp; store in ins-map</span>
                std::stringstream ss1, ss2;
                <span class="keywordtype">string</span> registers = ((*insAddrMap)[insAddr])-&gt;getRegisterStr();
                <span class="keywordflow">if</span> (insType == <span class="charliteral">&#39;R&#39;</span> || insType == <span class="charliteral">&#39;W&#39;</span>) {
                        ss1 &lt;&lt; insType &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; junk_addr &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; insAddr &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; registers;
                        <span class="comment">// ss1 &lt;&lt; insType &lt;&lt; &quot;,&quot; &lt;&lt; junk_addr &lt;&lt; &quot;,&quot; &lt;&lt; insAddr &lt;&lt; junk_s; (original reg names)</span>
                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (insType == <span class="charliteral">&#39;B&#39;</span>) {
                        ss1 &lt;&lt; insType &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; insAddr &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; brTaken &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; brDstAddr &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; registers;
                        <span class="comment">// ss1 &lt;&lt; insType &lt;&lt; &quot;,&quot; &lt;&lt; insAddr &lt;&lt; &quot;,&quot; &lt;&lt; brTaken &lt;&lt; &quot;,&quot; &lt;&lt; brDstAddr &lt;&lt; junk_s; (original reg names)</span>
                } <span class="keywordflow">else</span> { <span class="comment">//A &amp; F for insType</span>
                        ss1 &lt;&lt; insType &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; insAddr &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; registers;
                        <span class="comment">// ss1 &lt;&lt; insType &lt;&lt; &quot;,&quot; &lt;&lt; insAddr &lt;&lt; junk_s; (original reg names)</span>
                }
                std::string s = ss1.str();
                <span class="keywordflow">if</span> (dynBBMap.find(insAddr) != dynBBMap.end()) {
                        <span class="comment">//Trace runs micro-ops, so it can have ins-addr replicas</span>
                        <span class="keywordtype">string</span> t = dynBBMap[insAddr];
                        ss2 &lt;&lt; t &lt;&lt; s;
                        s = ss2.str();
                        dynBBMap[insAddr] = s;
                } <span class="keywordflow">else</span> {
                        dynBBMap.insert(pair&lt;ADDR,string&gt; (insAddr,s));
                }
                <span class="comment">// Crearte basicblock headers</span>
                <span class="keywordflow">if</span> (insType == <span class="charliteral">&#39;B&#39;</span>) {
                        <span class="keywordflow">if</span> (brFound != <span class="keyword">false</span>) printf(<span class="stringliteral">&quot;%llu\n&quot;</span>, brAddr);
                        <a class="code" href="backend_2utility_8h.html#aab1e54dcc40192f9704e8b252635450f">Assert</a>(brFound == <span class="keyword">false</span> &amp;&amp; <span class="stringliteral">&quot;Illegal value for brFound variable.&quot;</span>);
                        <span class="comment">// insType = &#39;b&#39;;</span>
                        brFound = <span class="keyword">true</span>;
                        brAddr = insAddr;
                }
        }
        <span class="keywordflow">if</span> (brFound) {
                fprintf(traceFileOutput, <span class="stringliteral">&quot;H:%llu\n&quot;</span>, brAddr);
                brFound = <span class="keyword">false</span>;
        }
        bbSizeHist[bbSize]++;
        fprintf(traceFileOutput, <span class="stringliteral">&quot;}\n&quot;</span>);
        printf(<span class="stringliteral">&quot;\tNumber of Trace Instructions Skipped: %lld (out of %lld)\n&quot;</span>, insSkipCounter, insCounter);
        printf(<span class="stringliteral">&quot;\tNumber of Trace Instructions Printed: %lld (out of %lld)\n&quot;</span>, printedInsCounter, insCounter-insSkipCounter);
        <a class="code" href="binaryTranslator_2stat_8cpp.html#ab157f0e7c21ee60b5b4212d99e5cfa48">DynBBSizeStat</a>(bbSizeHist, program_name);
}
</pre></div>
</div>
</div>
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address class="footer"><small>Generated on Fri Jul 18 2014 for PhArS by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </small></address>
</body>
</html>
