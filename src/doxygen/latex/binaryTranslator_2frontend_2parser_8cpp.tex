\hypertarget{binaryTranslator_2frontend_2parser_8cpp}{
\section{/home/milad/esc\_\-project/svn/PARS/src/binaryTranslator/frontend/parser.cpp File Reference}
\label{binaryTranslator_2frontend_2parser_8cpp}\index{/home/milad/esc\_\-project/svn/PARS/src/binaryTranslator/frontend/parser.cpp@{/home/milad/esc\_\-project/svn/PARS/src/binaryTranslator/frontend/parser.cpp}}
}
{\ttfamily \#include \char`\"{}pin.H\char`\"{}}\par
{\ttfamily \#include \char`\"{}instlib.H\char`\"{}}\par
{\ttfamily \#include \char`\"{}portability.H\char`\"{}}\par
{\ttfamily \#include $<$iostream$>$}\par
{\ttfamily \#include $<$fstream$>$}\par
{\ttfamily \#include $<$string.h$>$}\par
{\ttfamily \#include $<$string$>$}\par
{\ttfamily \#include \char`\"{}stInstruction.h\char`\"{}}\par
{\ttfamily \#include \char`\"{}../../lib/benchAddrRangeParser.h\char`\"{}}\par
{\ttfamily \#include \char`\"{}../../lib/message.h\char`\"{}}\par
Include dependency graph for parser.cpp:
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
KNOB$<$ string $>$ \hyperlink{binaryTranslator_2frontend_2parser_8cpp_a96d7d48ed562cf919945d14a3feda762}{KnobBenchName} (KNOB\_\-MODE\_\-WRITEONCE,\char`\"{}pintool\char`\"{},\char`\"{}b\char`\"{},\char`\"{}bench\char`\"{},\char`\"{}specify input benchmark \hyperlink{classconfig}{config} file name\char`\"{})
\item 
VOID \hyperlink{binaryTranslator_2frontend_2parser_8cpp_a222f3d3ed6c8963f32c2c581aebfd429}{setFallThrough} (INS ins)
\item 
VOID \hyperlink{binaryTranslator_2frontend_2parser_8cpp_a59f80b574c4a14e0fbf9703442582f49}{setDestination} (INS ins)
\item 
VOID \hyperlink{binaryTranslator_2frontend_2parser_8cpp_af3289249552a1470203b0101341ecc73}{setType} (INS ins)
\item 
VOID \hyperlink{binaryTranslator_2frontend_2parser_8cpp_afece89e0bb8014ad8f7748c1c1256f76}{setReg} (INS ins)
\item 
void \hyperlink{binaryTranslator_2frontend_2parser_8cpp_aa89073dbc41968bdf1c71da9badeb209}{dumpIns} ()
\item 
void \hyperlink{binaryTranslator_2frontend_2parser_8cpp_a37f9b9ca0fb71c0e48095eada9decfdb}{makeNewIns} ()
\item 
VOID \hyperlink{binaryTranslator_2frontend_2parser_8cpp_a781d53cb9e89bf1aba9c52d094c4ead8}{ImageLoad} (IMG img, VOID $\ast$v)
\item 
VOID \hyperlink{binaryTranslator_2frontend_2parser_8cpp_aa61669c70de306a0ba47bf5878b9f806}{Fini} (INT32 code, VOID $\ast$v)
\item 
INT32 \hyperlink{binaryTranslator_2frontend_2parser_8cpp_a9c89b15666dec97b4af91ba247b6a230}{Usage} ()
\item 
int \hyperlink{binaryTranslator_2frontend_2parser_8cpp_a0ddf1224851353fc92bfbff6f499fa97}{main} (int argc, char $\ast$argv\mbox{[}$\,$\mbox{]})
\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
FILE $\ast$ \hyperlink{binaryTranslator_2frontend_2parser_8cpp_acaa45cdca33f92d94cf63e2e4498487a}{trace\_\-static}
\item 
FILE $\ast$ \hyperlink{binaryTranslator_2frontend_2parser_8cpp_a7ed1bcdb23803dfda2895ff76f785d1a}{mem\_\-trace}
\item 
FILE $\ast$ \hyperlink{binaryTranslator_2frontend_2parser_8cpp_a42bc6696a6158fb473715316f0902236}{insAddrs}
\item 
\hyperlink{classList}{List}$<$ \hyperlink{classstInstruction}{stInstruction} $\ast$ $>$ $\ast$ \hyperlink{binaryTranslator_2frontend_2parser_8cpp_aa5ff4561ccfebb496d58f803932018e5}{g\_\-ins\_\-list}
\item 
\hyperlink{classbenchAddrRangeParser}{benchAddrRangeParser} $\ast$ \hyperlink{binaryTranslator_2frontend_2parser_8cpp_ab8497513f9992352953a905ed69eea4c}{bench\_\-addr\_\-space}
\end{DoxyCompactItemize}


\subsection{Function Documentation}
\hypertarget{binaryTranslator_2frontend_2parser_8cpp_aa89073dbc41968bdf1c71da9badeb209}{
\index{binaryTranslator/frontend/parser.cpp@{binaryTranslator/frontend/parser.cpp}!dumpIns@{dumpIns}}
\index{dumpIns@{dumpIns}!binaryTranslator/frontend/parser.cpp@{binaryTranslator/frontend/parser.cpp}}
\subsubsection[{dumpIns}]{\setlength{\rightskip}{0pt plus 5cm}void dumpIns (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}
\label{binaryTranslator_2frontend_2parser_8cpp_aa89073dbc41968bdf1c71da9badeb209}

\begin{DoxyCode}
                {
    Assert (g_ins_list->NumElements () <= 2);
    if (g_ins_list->NumElements () == 2) {
        stInstruction* st_ins = g_ins_list->Nth (0);
        st_ins->dump ();
        delete g_ins_list->Nth (0);
        g_ins_list->RemoveAt (0);
    }
}
\end{DoxyCode}


Here is the call graph for this function:




Here is the caller graph for this function:


\hypertarget{binaryTranslator_2frontend_2parser_8cpp_aa61669c70de306a0ba47bf5878b9f806}{
\index{binaryTranslator/frontend/parser.cpp@{binaryTranslator/frontend/parser.cpp}!Fini@{Fini}}
\index{Fini@{Fini}!binaryTranslator/frontend/parser.cpp@{binaryTranslator/frontend/parser.cpp}}
\subsubsection[{Fini}]{\setlength{\rightskip}{0pt plus 5cm}VOID Fini (
\begin{DoxyParamCaption}
\item[{INT32}]{code, }
\item[{VOID $\ast$}]{v}
\end{DoxyParamCaption}
)}}
\label{binaryTranslator_2frontend_2parser_8cpp_aa61669c70de306a0ba47bf5878b9f806}

\begin{DoxyCode}
{
    fclose(trace_static);
}
\end{DoxyCode}


Here is the caller graph for this function:


\hypertarget{binaryTranslator_2frontend_2parser_8cpp_a781d53cb9e89bf1aba9c52d094c4ead8}{
\index{binaryTranslator/frontend/parser.cpp@{binaryTranslator/frontend/parser.cpp}!ImageLoad@{ImageLoad}}
\index{ImageLoad@{ImageLoad}!binaryTranslator/frontend/parser.cpp@{binaryTranslator/frontend/parser.cpp}}
\subsubsection[{ImageLoad}]{\setlength{\rightskip}{0pt plus 5cm}VOID ImageLoad (
\begin{DoxyParamCaption}
\item[{IMG}]{img, }
\item[{VOID $\ast$}]{v}
\end{DoxyParamCaption}
)}}
\label{binaryTranslator_2frontend_2parser_8cpp_a781d53cb9e89bf1aba9c52d094c4ead8}

\begin{DoxyCode}
{
//    for (BBL bbl = TRACE_BblHead (trace); BBL_Valid (bbl); bbl = BBL_Next (bbl)
      )
    for (SEC sec = IMG_SecHead(img); SEC_Valid(sec); sec = SEC_Next(sec))
    {
        for (RTN rtn = SEC_RtnHead(sec); RTN_Valid(rtn); rtn = RTN_Next(rtn))
        {
            // Open the RTN.
            RTN_Open( rtn );            
            // Examine each instruction in the routine.
//            for (INS ins = BBL_InsHead (bbl); INS_Valid (ins); ins = INS_Next (
      ins))
            for( INS ins = RTN_InsHead(rtn); INS_Valid(ins); ins = INS_Next(ins) 
      )
            {
                /* INSTRUMENT ONLY INSTRUCTIONS IN THE APPLICATION CODE */
                if (!(INS_Address (ins) >= bench_addr_space->getStartAddr () && 
                      INS_Address (ins) <= bench_addr_space->getEndAddr ())) cont
      inue;
                makeNewIns ();
                stInstruction* st_ins = g_ins_list->Last ();
                setType (ins);
                st_ins->_mnemonic = INS_Mnemonic (ins);
                st_ins->_disassemble = INS_Disassemble (ins);
                st_ins->_addr = INS_Address (ins);
                setFallThrough (ins);
                setDestination (ins);
                setReg (ins);
                dumpIns ();
            }
            // Close the RTN.
            RTN_Close( rtn );
        }
    }
}
\end{DoxyCode}


Here is the call graph for this function:




Here is the caller graph for this function:


\hypertarget{binaryTranslator_2frontend_2parser_8cpp_a96d7d48ed562cf919945d14a3feda762}{
\index{binaryTranslator/frontend/parser.cpp@{binaryTranslator/frontend/parser.cpp}!KnobBenchName@{KnobBenchName}}
\index{KnobBenchName@{KnobBenchName}!binaryTranslator/frontend/parser.cpp@{binaryTranslator/frontend/parser.cpp}}
\subsubsection[{KnobBenchName}]{\setlength{\rightskip}{0pt plus 5cm}KNOB$<$string$>$ KnobBenchName (
\begin{DoxyParamCaption}
\item[{KNOB\_\-MODE\_\-WRITEONCE}]{, }
\item[{\char`\"{}pintool\char`\"{}}]{, }
\item[{\char`\"{}b\char`\"{}}]{, }
\item[{\char`\"{}bench\char`\"{}}]{, }
\item[{\char`\"{}specify input benchmark {\bf config} file name\char`\"{}}]{}
\end{DoxyParamCaption}
)}}
\label{binaryTranslator_2frontend_2parser_8cpp_a96d7d48ed562cf919945d14a3feda762}


Here is the caller graph for this function:


\hypertarget{binaryTranslator_2frontend_2parser_8cpp_a0ddf1224851353fc92bfbff6f499fa97}{
\index{binaryTranslator/frontend/parser.cpp@{binaryTranslator/frontend/parser.cpp}!main@{main}}
\index{main@{main}!binaryTranslator/frontend/parser.cpp@{binaryTranslator/frontend/parser.cpp}}
\subsubsection[{main}]{\setlength{\rightskip}{0pt plus 5cm}int main (
\begin{DoxyParamCaption}
\item[{int}]{argc, }
\item[{char $\ast$}]{argv\mbox{[}$\,$\mbox{]}}
\end{DoxyParamCaption}
)}}
\label{binaryTranslator_2frontend_2parser_8cpp_a0ddf1224851353fc92bfbff6f499fa97}

\begin{DoxyCode}
{
    g_msg.simStep ("INITIALIZE STATIC CODE PARSER");
    // Initialize pin & symbol manager
    if (PIN_Init(argc, argv)) return Usage();
    PIN_InitSymbols();

        const string ioPath = "/home/milad/esc_project/svn/PARS/src/binaryTransla
      tor/frontend/"; //argv[argc-2];
        trace_static = fopen((ioPath+"/static_trace.s").c_str(), "w");  
        mem_trace    = fopen("/scratch/tracesim/specint2006/mem_trace.csv", "w");
        
        insAddrs     = fopen("/scratch/tracesim/specint2006/ins_addrs.csv", "w");
        
    g_ins_list = new List<stInstruction*>;
    string benchmark = KnobBenchName.Value ();
    g_msg.simEvent (("BENCHMARK: " + benchmark).c_str ());
    bench_addr_space = new benchAddrRangeParser (benchmark);
    g_msg.simStep ("START OF CODE GENERATION");


    // Register ImageLoad to be called to instrument instructions
    IMG_AddInstrumentFunction(ImageLoad, 0);
//    TRACE_AddInstrumentFunction (ImageLoad, 0);
    PIN_AddFiniFunction(Fini, 0);
    
    // Start the program, never returns
    PIN_StartProgram();
    
    return 0;
}
\end{DoxyCode}


Here is the call graph for this function:


\hypertarget{binaryTranslator_2frontend_2parser_8cpp_a37f9b9ca0fb71c0e48095eada9decfdb}{
\index{binaryTranslator/frontend/parser.cpp@{binaryTranslator/frontend/parser.cpp}!makeNewIns@{makeNewIns}}
\index{makeNewIns@{makeNewIns}!binaryTranslator/frontend/parser.cpp@{binaryTranslator/frontend/parser.cpp}}
\subsubsection[{makeNewIns}]{\setlength{\rightskip}{0pt plus 5cm}void makeNewIns (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}
\label{binaryTranslator_2frontend_2parser_8cpp_a37f9b9ca0fb71c0e48095eada9decfdb}

\begin{DoxyCode}
                   {
    stInstruction* st_ins = new stInstruction (trace_static);
    g_ins_list->Append (st_ins);
}
\end{DoxyCode}


Here is the caller graph for this function:


\hypertarget{binaryTranslator_2frontend_2parser_8cpp_a59f80b574c4a14e0fbf9703442582f49}{
\index{binaryTranslator/frontend/parser.cpp@{binaryTranslator/frontend/parser.cpp}!setDestination@{setDestination}}
\index{setDestination@{setDestination}!binaryTranslator/frontend/parser.cpp@{binaryTranslator/frontend/parser.cpp}}
\subsubsection[{setDestination}]{\setlength{\rightskip}{0pt plus 5cm}VOID setDestination (
\begin{DoxyParamCaption}
\item[{INS}]{ins}
\end{DoxyParamCaption}
)}}
\label{binaryTranslator_2frontend_2parser_8cpp_a59f80b574c4a14e0fbf9703442582f49}

\begin{DoxyCode}
                              {
    stInstruction* cur_ins = g_ins_list->Last ();
        if (cur_ins->_has_destination == false && INS_IsDirectBranchOrCall (ins))
       {
                cur_ins->_has_destination = true;
        cur_ins->_destination = INS_DirectBranchOrCallTargetAddress(ins);
    }
}
\end{DoxyCode}


Here is the caller graph for this function:


\hypertarget{binaryTranslator_2frontend_2parser_8cpp_a222f3d3ed6c8963f32c2c581aebfd429}{
\index{binaryTranslator/frontend/parser.cpp@{binaryTranslator/frontend/parser.cpp}!setFallThrough@{setFallThrough}}
\index{setFallThrough@{setFallThrough}!binaryTranslator/frontend/parser.cpp@{binaryTranslator/frontend/parser.cpp}}
\subsubsection[{setFallThrough}]{\setlength{\rightskip}{0pt plus 5cm}VOID setFallThrough (
\begin{DoxyParamCaption}
\item[{INS}]{ins}
\end{DoxyParamCaption}
)}}
\label{binaryTranslator_2frontend_2parser_8cpp_a222f3d3ed6c8963f32c2c581aebfd429}

\begin{DoxyCode}
                              {
    stInstruction* cur_ins = g_ins_list->Last ();
    if (INS_HasFallThrough (ins)) {
        cur_ins->_has_fall_through = true; 
        cur_ins->_fall_through = INS_NextAddress (ins);
    }

    if (g_ins_list->NumElements () != 2) return;
    stInstruction* prv_ins = g_ins_list->Nth (0);

    /*-- 
     * CALL FUNCTINOS NEED SPECIAL TREATMENT FOR FINDING THEIR FALL-THROUGH 
     * --*/
    if (prv_ins->_type == 'c' && prv_ins->_has_fall_through == false) {
        prv_ins->_has_fall_through = true;
        prv_ins->_fall_through = INS_Address (ins);
    }
}
\end{DoxyCode}


Here is the caller graph for this function:


\hypertarget{binaryTranslator_2frontend_2parser_8cpp_afece89e0bb8014ad8f7748c1c1256f76}{
\index{binaryTranslator/frontend/parser.cpp@{binaryTranslator/frontend/parser.cpp}!setReg@{setReg}}
\index{setReg@{setReg}!binaryTranslator/frontend/parser.cpp@{binaryTranslator/frontend/parser.cpp}}
\subsubsection[{setReg}]{\setlength{\rightskip}{0pt plus 5cm}VOID setReg (
\begin{DoxyParamCaption}
\item[{INS}]{ins}
\end{DoxyParamCaption}
)}}
\label{binaryTranslator_2frontend_2parser_8cpp_afece89e0bb8014ad8f7748c1c1256f76}

\begin{DoxyCode}
                      {
    stInstruction* st_ins = g_ins_list->Last ();
        // UINT32 operandCount = INS_MaxNumRRegs(ins)+INS_MaxNumWRegs(ins);
        if (INS_MaxNumRRegs(ins) > 0) {
                for (int i = 0; i < (int)INS_MaxNumRRegs(ins); i++) {
                        st_ins->_regs.Append (REG_StringShort(REG_FullRegName(INS
      _RegR(ins,i))));
                        st_ins->_reg_types.Append (REG_READ);
                }
        }
        if (INS_MaxNumWRegs(ins) > 0) {
                for (int i = 0; i < (int)INS_MaxNumWRegs(ins); i++) {
                        st_ins->_regs.Append (REG_StringShort(REG_FullRegName(INS
      _RegW(ins,i))));
                        st_ins->_reg_types.Append (REG_WRITE);
                }
        }
}
\end{DoxyCode}


Here is the call graph for this function:




Here is the caller graph for this function:


\hypertarget{binaryTranslator_2frontend_2parser_8cpp_af3289249552a1470203b0101341ecc73}{
\index{binaryTranslator/frontend/parser.cpp@{binaryTranslator/frontend/parser.cpp}!setType@{setType}}
\index{setType@{setType}!binaryTranslator/frontend/parser.cpp@{binaryTranslator/frontend/parser.cpp}}
\subsubsection[{setType}]{\setlength{\rightskip}{0pt plus 5cm}VOID setType (
\begin{DoxyParamCaption}
\item[{INS}]{ins}
\end{DoxyParamCaption}
)}}
\label{binaryTranslator_2frontend_2parser_8cpp_af3289249552a1470203b0101341ecc73}

\begin{DoxyCode}
                       {
    stInstruction* st_ins = g_ins_list->Last ();
        bool noType = true;
        if (INS_IsSyscall(ins)) {
        st_ins->_type = 's';
                noType = false;
    } else if(INS_IsCall(ins) || INS_IsProcedureCall (ins)) {
        st_ins->_type = 'c';
                noType = false;
        } else if(INS_IsRet(ins) || INS_IsSysret(ins)) {
        st_ins->_type = 'r';
                noType = false;
        } else if(INS_IsBranch(ins) && INS_HasFallThrough(ins)) {
        st_ins->_type = 'b';
                noType = false;
        } else if(INS_IsBranch(ins) && !INS_HasFallThrough(ins)) {
        st_ins->_type = 'j';
                noType = false;
        } else if(INS_IsMemoryRead(ins)) {
        st_ins->_type = 'R';
        st_ins->_mem_r_size = INS_MemoryReadSize(ins);
                noType = false;
        } else if(INS_IsMemoryWrite(ins)) {
        st_ins->_type = 'W';
        st_ins->_mem_w_size = INS_MemoryWriteSize(ins);
                noType = false;
        } else if(INS_IsNop(ins)) {
        st_ins->_type = 'n';
                noType = false;
        } else if(noType == true) {
        st_ins->_type = 'o';
        }
}
\end{DoxyCode}


Here is the caller graph for this function:


\hypertarget{binaryTranslator_2frontend_2parser_8cpp_a9c89b15666dec97b4af91ba247b6a230}{
\index{binaryTranslator/frontend/parser.cpp@{binaryTranslator/frontend/parser.cpp}!Usage@{Usage}}
\index{Usage@{Usage}!binaryTranslator/frontend/parser.cpp@{binaryTranslator/frontend/parser.cpp}}
\subsubsection[{Usage}]{\setlength{\rightskip}{0pt plus 5cm}INT32 Usage (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}
\label{binaryTranslator_2frontend_2parser_8cpp_a9c89b15666dec97b4af91ba247b6a230}

\begin{DoxyCode}
{
    cerr << "This is the invocation pintool" << endl;
    cerr << endl << KNOB_BASE::StringKnobSummary() << endl;
    return -1;
}
\end{DoxyCode}


Here is the caller graph for this function:




\subsection{Variable Documentation}
\hypertarget{binaryTranslator_2frontend_2parser_8cpp_ab8497513f9992352953a905ed69eea4c}{
\index{binaryTranslator/frontend/parser.cpp@{binaryTranslator/frontend/parser.cpp}!bench\_\-addr\_\-space@{bench\_\-addr\_\-space}}
\index{bench\_\-addr\_\-space@{bench\_\-addr\_\-space}!binaryTranslator/frontend/parser.cpp@{binaryTranslator/frontend/parser.cpp}}
\subsubsection[{bench\_\-addr\_\-space}]{\setlength{\rightskip}{0pt plus 5cm}{\bf benchAddrRangeParser}$\ast$ {\bf bench\_\-addr\_\-space}}}
\label{binaryTranslator_2frontend_2parser_8cpp_ab8497513f9992352953a905ed69eea4c}
\hypertarget{binaryTranslator_2frontend_2parser_8cpp_aa5ff4561ccfebb496d58f803932018e5}{
\index{binaryTranslator/frontend/parser.cpp@{binaryTranslator/frontend/parser.cpp}!g\_\-ins\_\-list@{g\_\-ins\_\-list}}
\index{g\_\-ins\_\-list@{g\_\-ins\_\-list}!binaryTranslator/frontend/parser.cpp@{binaryTranslator/frontend/parser.cpp}}
\subsubsection[{g\_\-ins\_\-list}]{\setlength{\rightskip}{0pt plus 5cm}{\bf List}$<${\bf stInstruction}$\ast$$>$$\ast$ {\bf g\_\-ins\_\-list}}}
\label{binaryTranslator_2frontend_2parser_8cpp_aa5ff4561ccfebb496d58f803932018e5}
\hypertarget{binaryTranslator_2frontend_2parser_8cpp_a42bc6696a6158fb473715316f0902236}{
\index{binaryTranslator/frontend/parser.cpp@{binaryTranslator/frontend/parser.cpp}!insAddrs@{insAddrs}}
\index{insAddrs@{insAddrs}!binaryTranslator/frontend/parser.cpp@{binaryTranslator/frontend/parser.cpp}}
\subsubsection[{insAddrs}]{\setlength{\rightskip}{0pt plus 5cm}FILE$\ast$ {\bf insAddrs}}}
\label{binaryTranslator_2frontend_2parser_8cpp_a42bc6696a6158fb473715316f0902236}
\hypertarget{binaryTranslator_2frontend_2parser_8cpp_a7ed1bcdb23803dfda2895ff76f785d1a}{
\index{binaryTranslator/frontend/parser.cpp@{binaryTranslator/frontend/parser.cpp}!mem\_\-trace@{mem\_\-trace}}
\index{mem\_\-trace@{mem\_\-trace}!binaryTranslator/frontend/parser.cpp@{binaryTranslator/frontend/parser.cpp}}
\subsubsection[{mem\_\-trace}]{\setlength{\rightskip}{0pt plus 5cm}FILE$\ast$ {\bf mem\_\-trace}}}
\label{binaryTranslator_2frontend_2parser_8cpp_a7ed1bcdb23803dfda2895ff76f785d1a}
\hypertarget{binaryTranslator_2frontend_2parser_8cpp_acaa45cdca33f92d94cf63e2e4498487a}{
\index{binaryTranslator/frontend/parser.cpp@{binaryTranslator/frontend/parser.cpp}!trace\_\-static@{trace\_\-static}}
\index{trace\_\-static@{trace\_\-static}!binaryTranslator/frontend/parser.cpp@{binaryTranslator/frontend/parser.cpp}}
\subsubsection[{trace\_\-static}]{\setlength{\rightskip}{0pt plus 5cm}FILE$\ast$ {\bf trace\_\-static}}}
\label{binaryTranslator_2frontend_2parser_8cpp_acaa45cdca33f92d94cf63e2e4498487a}
